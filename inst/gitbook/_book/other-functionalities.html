<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Other functionalities | dispRity R package manual</title>
  <meta name="description" content="6 Other functionalities | dispRity R package manual" />
  <meta name="generator" content="bookdown 0.36 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Other functionalities | dispRity R package manual" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="6 Other functionalities | dispRity R package manual" />
  <meta name="github-repo" content="TGuillerme/dispRity" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Other functionalities | dispRity R package manual" />
  
  <meta name="twitter:description" content="6 Other functionalities | dispRity R package manual" />
  

<meta name="author" content="Thomas Guillerme (guillert@tcd.ie)" />


<meta name="date" content="2024-03-08" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="making-stuff-up.html"/>
<link rel="next" href="the-guts-of-the-disprity-package.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="libs/rglWebGL-binding-1.2.8/rglWebGL.js"></script>
<link href="libs/rglwidgetClass-1.2.8/rgl.css" rel="stylesheet" />
<script src="libs/rglwidgetClass-1.2.8/rglClass.src.js"></script>
<script src="libs/rglwidgetClass-1.2.8/utils.src.js"></script>
<script src="libs/rglwidgetClass-1.2.8/buffer.src.js"></script>
<script src="libs/rglwidgetClass-1.2.8/subscenes.src.js"></script>
<script src="libs/rglwidgetClass-1.2.8/shaders.src.js"></script>
<script src="libs/rglwidgetClass-1.2.8/shadersrc.src.js"></script>
<script src="libs/rglwidgetClass-1.2.8/textures.src.js"></script>
<script src="libs/rglwidgetClass-1.2.8/projection.src.js"></script>
<script src="libs/rglwidgetClass-1.2.8/mouse.src.js"></script>
<script src="libs/rglwidgetClass-1.2.8/init.src.js"></script>
<script src="libs/rglwidgetClass-1.2.8/pieces.src.js"></script>
<script src="libs/rglwidgetClass-1.2.8/draw.src.js"></script>
<script src="libs/rglwidgetClass-1.2.8/controls.src.js"></script>
<script src="libs/rglwidgetClass-1.2.8/selection.src.js"></script>
<script src="libs/rglwidgetClass-1.2.8/rglTimer.src.js"></script>
<script src="libs/rglwidgetClass-1.2.8/pretty.src.js"></script>
<script src="libs/rglwidgetClass-1.2.8/axes.src.js"></script>
<script src="libs/rglwidgetClass-1.2.8/animation.src.js"></script>
<script src="libs/CanvasMatrix4-1.2.8/CanvasMatrix.src.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">dispRity manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> <code>dispRity</code></a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#what-is-disprity"><i class="fa fa-check"></i><b>1.1</b> What is <code>dispRity</code>?</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="index.html#modular"><i class="fa fa-check"></i><b>1.1.1</b> Modular?</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#installing-and-running-the-package"><i class="fa fa-check"></i><b>1.2</b> Installing and running the package</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#version"><i class="fa fa-check"></i><b>1.3</b> Which version do I choose?</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#disprity-is-always-changing-how-do-i-know-its-not-broken"><i class="fa fa-check"></i><b>1.4</b> <code>dispRity</code> is always changing, how do I know it’s not broken?</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#help"><i class="fa fa-check"></i><b>1.5</b> Help</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#citations"><i class="fa fa-check"></i><b>1.6</b> Citations</a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="index.html"><a href="index.html#why-is-it-important-to-cite-us"><i class="fa fa-check"></i><b>1.6.1</b> Why is it important to cite us?</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="glossary.html"><a href="glossary.html"><i class="fa fa-check"></i><b>2</b> Glossary</a>
<ul>
<li class="chapter" data-level="2.1" data-path="glossary.html"><a href="glossary.html#glossary-equivalences-in-palaeobiology-and-ecology"><i class="fa fa-check"></i><b>2.1</b> Glossary equivalences in palaeobiology and ecology</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="getting-started-with-disprity.html"><a href="getting-started-with-disprity.html"><i class="fa fa-check"></i><b>3</b> Getting started with <code>dispRity</code></a>
<ul>
<li class="chapter" data-level="3.1" data-path="getting-started-with-disprity.html"><a href="getting-started-with-disprity.html#what-sort-of-data-does-disprity-work-with"><i class="fa fa-check"></i><b>3.1</b> What sort of data does <code>dispRity</code> work with?</a></li>
<li class="chapter" data-level="3.2" data-path="getting-started-with-disprity.html"><a href="getting-started-with-disprity.html#ordinated-matrices"><i class="fa fa-check"></i><b>3.2</b> Ordinated matrices</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="getting-started-with-disprity.html"><a href="getting-started-with-disprity.html#ordination-matrices-from-geomorph"><i class="fa fa-check"></i><b>3.2.1</b> Ordination matrices from <code>geomorph</code></a></li>
<li class="chapter" data-level="3.2.2" data-path="getting-started-with-disprity.html"><a href="getting-started-with-disprity.html#Claddis-ordination"><i class="fa fa-check"></i><b>3.2.2</b> Ordination matrices from <code>Claddis</code></a></li>
<li class="chapter" data-level="3.2.3" data-path="getting-started-with-disprity.html"><a href="getting-started-with-disprity.html#other-kinds-of-ordination-matrices"><i class="fa fa-check"></i><b>3.2.3</b> Other kinds of ordination matrices</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="getting-started-with-disprity.html"><a href="getting-started-with-disprity.html#simpleanalysis"><i class="fa fa-check"></i><b>3.3</b> Performing a simple dispRity analysis</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="getting-started-with-disprity.html"><a href="getting-started-with-disprity.html#example-data"><i class="fa fa-check"></i><b>3.3.1</b> Example data</a></li>
<li class="chapter" data-level="3.3.2" data-path="getting-started-with-disprity.html"><a href="getting-started-with-disprity.html#disparity-through-time"><i class="fa fa-check"></i><b>3.3.2</b> Disparity through time</a></li>
<li class="chapter" data-level="3.3.3" data-path="getting-started-with-disprity.html"><a href="getting-started-with-disprity.html#disparity-among-groups"><i class="fa fa-check"></i><b>3.3.3</b> Disparity among groups</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html"><i class="fa fa-check"></i><b>4</b> Details of specific functions</a>
<ul>
<li class="chapter" data-level="4.1" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#chrono-subsets"><i class="fa fa-check"></i><b>4.1</b> Time slicing</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#time-binning"><i class="fa fa-check"></i><b>4.1.1</b> Time-binning</a></li>
<li class="chapter" data-level="4.1.2" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#time-slicing"><i class="fa fa-check"></i><b>4.1.2</b> Time-slicing</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#custom-subsets"><i class="fa fa-check"></i><b>4.2</b> Customised subsets</a></li>
<li class="chapter" data-level="4.3" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#bootstraps-and-rarefactions"><i class="fa fa-check"></i><b>4.3</b> Bootstraps and rarefactions</a></li>
<li class="chapter" data-level="4.4" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#disparity-metrics"><i class="fa fa-check"></i><b>4.4</b> Disparity metrics</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#the-function-dimension-levels"><i class="fa fa-check"></i><b>4.4.1</b> The function dimension-levels</a></li>
<li class="chapter" data-level="4.4.2" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#betweengroupmetricsexplain"><i class="fa fa-check"></i><b>4.4.2</b> Between groups metrics</a></li>
<li class="chapter" data-level="4.4.3" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#makemetric"><i class="fa fa-check"></i><b>4.4.3</b> <code>make.metric</code></a></li>
<li class="chapter" data-level="4.4.4" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#metrics-in-the-disprity-function"><i class="fa fa-check"></i><b>4.4.4</b> Metrics in the <code>dispRity</code> function</a></li>
<li class="chapter" data-level="4.4.5" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#metrics-implemented-in-disprity"><i class="fa fa-check"></i><b>4.4.5</b> Metrics implemented in <code>dispRity</code></a></li>
<li class="chapter" data-level="4.4.6" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#equations-and-implementations"><i class="fa fa-check"></i><b>4.4.6</b> Equations and implementations</a></li>
<li class="chapter" data-level="4.4.7" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#using-the-different-disparity-metrics"><i class="fa fa-check"></i><b>4.4.7</b> Using the different disparity metrics</a></li>
<li class="chapter" data-level="4.4.8" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#which-disparity-metric-to-choose"><i class="fa fa-check"></i><b>4.4.8</b> Which disparity metric to choose?</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#summarising-disprity-data-plots"><i class="fa fa-check"></i><b>4.5</b> Summarising dispRity data (plots)</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#summarising-disprity-data"><i class="fa fa-check"></i><b>4.5.1</b> Summarising <code>dispRity</code> data</a></li>
<li class="chapter" data-level="4.5.2" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#plotting-disprity-data"><i class="fa fa-check"></i><b>4.5.2</b> Plotting <code>dispRity</code> data</a></li>
<li class="chapter" data-level="4.5.3" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#type-preview"><i class="fa fa-check"></i><b>4.5.3</b> <code>type = preview</code></a></li>
<li class="chapter" data-level="4.5.4" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#graphical-options-with-..."><i class="fa fa-check"></i><b>4.5.4</b> Graphical options with <code>...</code></a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#testing-disparity-hypotheses"><i class="fa fa-check"></i><b>4.6</b> Testing disparity hypotheses</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#adonis"><i class="fa fa-check"></i><b>4.6.1</b> NPMANOVA in <code>dispRity</code></a></li>
<li class="chapter" data-level="4.6.2" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#dtt"><i class="fa fa-check"></i><b>4.6.2</b> <code>geiger::dtt</code> model fitting in <code>dispRity</code></a></li>
<li class="chapter" data-level="4.6.3" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#null-test"><i class="fa fa-check"></i><b>4.6.3</b> null morphospace testing with <code>null.test</code></a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#model-fitting"><i class="fa fa-check"></i><b>4.7</b> Fitting modes of evolution to disparity data</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#simple-modes-of-disparity-change-through-time"><i class="fa fa-check"></i><b>4.7.1</b> Simple modes of disparity change through time</a></li>
<li class="chapter" data-level="4.7.2" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#plot-and-run-simulation-tests-in-a-single-step"><i class="fa fa-check"></i><b>4.7.2</b> Plot and run simulation tests in a single step</a></li>
<li class="chapter" data-level="4.7.3" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#multiple-modes-of-evolution-time-shifts"><i class="fa fa-check"></i><b>4.7.3</b> Multiple modes of evolution (time shifts)</a></li>
<li class="chapter" data-level="4.7.4" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#model.test.sim"><i class="fa fa-check"></i><b>4.7.4</b> <code>model.test.sim</code></a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#disparity-distribution"><i class="fa fa-check"></i><b>4.8</b> Disparity as a distribution</a></li>
<li class="chapter" data-level="4.9" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#other-matrices"><i class="fa fa-check"></i><b>4.9</b> Disparity from other matrices</a></li>
<li class="chapter" data-level="4.10" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#multi.input"><i class="fa fa-check"></i><b>4.10</b> Disparity from multiple matrices (and multiple trees!)</a></li>
<li class="chapter" data-level="4.11" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#dispRitree"><i class="fa fa-check"></i><b>4.11</b> Disparity with trees: <em>dispRitree!</em></a></li>
<li class="chapter" data-level="4.12" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#covar"><i class="fa fa-check"></i><b>4.12</b> Disparity of variance-covariance matrices (covar)</a>
<ul>
<li class="chapter" data-level="4.12.1" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#creating-a-disprity-object-with-a-covar-component"><i class="fa fa-check"></i><b>4.12.1</b> Creating a <code>dispRity</code> object with a <code>$covar</code> component</a></li>
<li class="chapter" data-level="4.12.2" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#visualising-covar-objects"><i class="fa fa-check"></i><b>4.12.2</b> Visualising covar objects</a></li>
<li class="chapter" data-level="4.12.3" data-path="details-of-specific-functions.html"><a href="details-of-specific-functions.html#disparity-analyses-with-a-covar-component"><i class="fa fa-check"></i><b>4.12.3</b> Disparity analyses with a <code>$covar</code> component</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="making-stuff-up.html"><a href="making-stuff-up.html"><i class="fa fa-check"></i><b>5</b> Making stuff up!</a>
<ul>
<li class="chapter" data-level="5.1" data-path="making-stuff-up.html"><a href="making-stuff-up.html#simulating-discrete-morphological-data"><i class="fa fa-check"></i><b>5.1</b> Simulating discrete morphological data</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="making-stuff-up.html"><a href="making-stuff-up.html#a-more-detailed-description"><i class="fa fa-check"></i><b>5.1.1</b> A more detailed description</a></li>
<li class="chapter" data-level="5.1.2" data-path="making-stuff-up.html"><a href="making-stuff-up.html#parameters-for-a-realisticish-matrix"><i class="fa fa-check"></i><b>5.1.2</b> Parameters for a realistic(ish) matrix</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="making-stuff-up.html"><a href="making-stuff-up.html#simulating-multidimensional-spaces"><i class="fa fa-check"></i><b>5.2</b> Simulating multidimensional spaces</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="making-stuff-up.html"><a href="making-stuff-up.html#personalised-dimensions-distributions"><i class="fa fa-check"></i><b>5.2.1</b> Personalised dimensions distributions</a></li>
<li class="chapter" data-level="5.2.2" data-path="making-stuff-up.html"><a href="making-stuff-up.html#visualising-the-space"><i class="fa fa-check"></i><b>5.2.2</b> Visualising the space</a></li>
<li class="chapter" data-level="5.2.3" data-path="making-stuff-up.html"><a href="making-stuff-up.html#generating-realistic-spaces"><i class="fa fa-check"></i><b>5.2.3</b> Generating realistic spaces</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="other-functionalities.html"><a href="other-functionalities.html"><i class="fa fa-check"></i><b>6</b> Other functionalities</a>
<ul>
<li class="chapter" data-level="6.1" data-path="other-functionalities.html"><a href="other-functionalities.html#char.diff"><i class="fa fa-check"></i><b>6.1</b> <code>char.diff</code></a></li>
<li class="chapter" data-level="6.2" data-path="other-functionalities.html"><a href="other-functionalities.html#clean.data"><i class="fa fa-check"></i><b>6.2</b> <code>clean.data</code></a></li>
<li class="chapter" data-level="6.3" data-path="other-functionalities.html"><a href="other-functionalities.html#crown.stem"><i class="fa fa-check"></i><b>6.3</b> <code>crown.stem</code></a></li>
<li class="chapter" data-level="6.4" data-path="other-functionalities.html"><a href="other-functionalities.html#get.bin.ages"><i class="fa fa-check"></i><b>6.4</b> <code>get.bin.ages</code></a></li>
<li class="chapter" data-level="6.5" data-path="other-functionalities.html"><a href="other-functionalities.html#match.tip.edge"><i class="fa fa-check"></i><b>6.5</b> <code>match.tip.edge</code></a></li>
<li class="chapter" data-level="6.6" data-path="other-functionalities.html"><a href="other-functionalities.html#MCMCglmm-utilities"><i class="fa fa-check"></i><b>6.6</b> <code>MCMCglmm</code> utilities</a></li>
<li class="chapter" data-level="6.7" data-path="other-functionalities.html"><a href="other-functionalities.html#pair.plot"><i class="fa fa-check"></i><b>6.7</b> <code>pair.plot</code></a></li>
<li class="chapter" data-level="6.8" data-path="other-functionalities.html"><a href="other-functionalities.html#reduce.matrix"><i class="fa fa-check"></i><b>6.8</b> <code>reduce.matrix</code></a></li>
<li class="chapter" data-level="6.9" data-path="other-functionalities.html"><a href="other-functionalities.html#select.axes"><i class="fa fa-check"></i><b>6.9</b> <code>select.axes</code></a></li>
<li class="chapter" data-level="6.10" data-path="other-functionalities.html"><a href="other-functionalities.html#set.root.time"><i class="fa fa-check"></i><b>6.10</b> <code>set.root.time</code></a></li>
<li class="chapter" data-level="6.11" data-path="other-functionalities.html"><a href="other-functionalities.html#slice.tree"><i class="fa fa-check"></i><b>6.11</b> <code>slice.tree</code></a></li>
<li class="chapter" data-level="6.12" data-path="other-functionalities.html"><a href="other-functionalities.html#slide.nodes-and-remove.zero.brlen"><i class="fa fa-check"></i><b>6.12</b> <code>slide.nodes</code> and <code>remove.zero.brlen</code></a></li>
<li class="chapter" data-level="6.13" data-path="other-functionalities.html"><a href="other-functionalities.html#tree.age"><i class="fa fa-check"></i><b>6.13</b> <code>tree.age</code></a></li>
<li class="chapter" data-level="6.14" data-path="other-functionalities.html"><a href="other-functionalities.html#multi.ace"><i class="fa fa-check"></i><b>6.14</b> <code>multi.ace</code></a>
<ul>
<li class="chapter" data-level="6.14.1" data-path="other-functionalities.html"><a href="other-functionalities.html#using-different-character-tokens-in-different-situations"><i class="fa fa-check"></i><b>6.14.1</b> Using different character tokens in different situations</a></li>
<li class="chapter" data-level="6.14.2" data-path="other-functionalities.html"><a href="other-functionalities.html#feeding-the-results-to-char.diff-to-get-distance-matrices"><i class="fa fa-check"></i><b>6.14.2</b> Feeding the results to <code>char.diff</code> to get distance matrices</a></li>
<li class="chapter" data-level="6.14.3" data-path="other-functionalities.html"><a href="other-functionalities.html#running-ancestral-states-estimations-for-continuous-characters"><i class="fa fa-check"></i><b>6.14.3</b> Running ancestral states estimations for continuous characters</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="the-guts-of-the-disprity-package.html"><a href="the-guts-of-the-disprity-package.html"><i class="fa fa-check"></i><b>7</b> The guts of the <code>dispRity</code> package</a>
<ul>
<li class="chapter" data-level="7.1" data-path="the-guts-of-the-disprity-package.html"><a href="the-guts-of-the-disprity-package.html#manipulating-disprity-objects"><i class="fa fa-check"></i><b>7.1</b> Manipulating <code>dispRity</code> objects</a></li>
<li class="chapter" data-level="7.2" data-path="the-guts-of-the-disprity-package.html"><a href="the-guts-of-the-disprity-package.html#utilities"><i class="fa fa-check"></i><b>7.2</b> <code>dispRity</code> utilities</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="the-guts-of-the-disprity-package.html"><a href="the-guts-of-the-disprity-package.html#disprity-object-utilities"><i class="fa fa-check"></i><b>7.2.1</b> <code>dispRity</code> object utilities <a name="dispRity.utilities"></a></a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="the-guts-of-the-disprity-package.html"><a href="the-guts-of-the-disprity-package.html#disprity-object"><i class="fa fa-check"></i><b>7.3</b> The <code>dispRity</code> object content</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="the-guts-of-the-disprity-package.html"><a href="the-guts-of-the-disprity-package.html#matrix"><i class="fa fa-check"></i><b>7.3.1</b> <code>$matrix</code></a></li>
<li class="chapter" data-level="7.3.2" data-path="the-guts-of-the-disprity-package.html"><a href="the-guts-of-the-disprity-package.html#call"><i class="fa fa-check"></i><b>7.3.2</b> <code>$call</code></a></li>
<li class="chapter" data-level="7.3.3" data-path="the-guts-of-the-disprity-package.html"><a href="the-guts-of-the-disprity-package.html#subsets"><i class="fa fa-check"></i><b>7.3.3</b> <code>$subsets</code></a></li>
<li class="chapter" data-level="7.3.4" data-path="the-guts-of-the-disprity-package.html"><a href="the-guts-of-the-disprity-package.html#disparity"><i class="fa fa-check"></i><b>7.3.4</b> <code>$disparity</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="disprity-ecology-demo.html"><a href="disprity-ecology-demo.html"><i class="fa fa-check"></i><b>8</b> dispRity ecology demo</a>
<ul>
<li class="chapter" data-level="8.1" data-path="disprity-ecology-demo.html"><a href="disprity-ecology-demo.html#data"><i class="fa fa-check"></i><b>8.1</b> Data</a></li>
<li class="chapter" data-level="8.2" data-path="disprity-ecology-demo.html"><a href="disprity-ecology-demo.html#classic-analysis"><i class="fa fa-check"></i><b>8.2</b> Classic analysis</a></li>
<li class="chapter" data-level="8.3" data-path="disprity-ecology-demo.html"><a href="disprity-ecology-demo.html#a-multidimensional-approach-with-disprity"><i class="fa fa-check"></i><b>8.3</b> A multidimensional approach with <code>dispRity</code></a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="disprity-ecology-demo.html"><a href="disprity-ecology-demo.html#bootstrapping-the-data"><i class="fa fa-check"></i><b>8.3.1</b> Bootstrapping the data</a></li>
<li class="chapter" data-level="8.3.2" data-path="disprity-ecology-demo.html"><a href="disprity-ecology-demo.html#calculating-disparity"><i class="fa fa-check"></i><b>8.3.2</b> Calculating disparity</a></li>
<li class="chapter" data-level="8.3.3" data-path="disprity-ecology-demo.html"><a href="disprity-ecology-demo.html#summarising-the-results-plot"><i class="fa fa-check"></i><b>8.3.3</b> Summarising the results (plot)</a></li>
<li class="chapter" data-level="8.3.4" data-path="disprity-ecology-demo.html"><a href="disprity-ecology-demo.html#testing-hypothesis"><i class="fa fa-check"></i><b>8.3.4</b> Testing hypothesis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="palaeobiology-demo-disparity-through-time-and-within-groups.html"><a href="palaeobiology-demo-disparity-through-time-and-within-groups.html"><i class="fa fa-check"></i><b>9</b> Palaeobiology demo: disparity-through-time and within groups</a>
<ul>
<li class="chapter" data-level="9.1" data-path="palaeobiology-demo-disparity-through-time-and-within-groups.html"><a href="palaeobiology-demo-disparity-through-time-and-within-groups.html#before-starting"><i class="fa fa-check"></i><b>9.1</b> Before starting</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="palaeobiology-demo-disparity-through-time-and-within-groups.html"><a href="palaeobiology-demo-disparity-through-time-and-within-groups.html#the-morphospace"><i class="fa fa-check"></i><b>9.1.1</b> The morphospace</a></li>
<li class="chapter" data-level="9.1.2" data-path="palaeobiology-demo-disparity-through-time-and-within-groups.html"><a href="palaeobiology-demo-disparity-through-time-and-within-groups.html#setting-up-your-own-data"><i class="fa fa-check"></i><b>9.1.2</b> Setting up your own data</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="palaeobiology-demo-disparity-through-time-and-within-groups.html"><a href="palaeobiology-demo-disparity-through-time-and-within-groups.html#a-disparity-through-time-analysis"><i class="fa fa-check"></i><b>9.2</b> A disparity-through-time analysis</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="palaeobiology-demo-disparity-through-time-and-within-groups.html"><a href="palaeobiology-demo-disparity-through-time-and-within-groups.html#splitting-the-morphospace-through-time"><i class="fa fa-check"></i><b>9.2.1</b> Splitting the morphospace through time</a></li>
<li class="chapter" data-level="9.2.2" data-path="palaeobiology-demo-disparity-through-time-and-within-groups.html"><a href="palaeobiology-demo-disparity-through-time-and-within-groups.html#bootstrapping-the-data-1"><i class="fa fa-check"></i><b>9.2.2</b> Bootstrapping the data</a></li>
<li class="chapter" data-level="9.2.3" data-path="palaeobiology-demo-disparity-through-time-and-within-groups.html"><a href="palaeobiology-demo-disparity-through-time-and-within-groups.html#calculating-disparity-1"><i class="fa fa-check"></i><b>9.2.3</b> Calculating disparity</a></li>
<li class="chapter" data-level="9.2.4" data-path="palaeobiology-demo-disparity-through-time-and-within-groups.html"><a href="palaeobiology-demo-disparity-through-time-and-within-groups.html#plotting-the-results"><i class="fa fa-check"></i><b>9.2.4</b> Plotting the results</a></li>
<li class="chapter" data-level="9.2.5" data-path="palaeobiology-demo-disparity-through-time-and-within-groups.html"><a href="palaeobiology-demo-disparity-through-time-and-within-groups.html#testing-differences"><i class="fa fa-check"></i><b>9.2.5</b> Testing differences</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="palaeobiology-demo-disparity-through-time-and-within-groups.html"><a href="palaeobiology-demo-disparity-through-time-and-within-groups.html#some-more-advanced-stuff"><i class="fa fa-check"></i><b>9.3</b> Some more advanced stuff</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="morphometric-geometric-demo-a-between-group-analysis.html"><a href="morphometric-geometric-demo-a-between-group-analysis.html"><i class="fa fa-check"></i><b>10</b> Morphometric geometric demo: a between group analysis</a>
<ul>
<li class="chapter" data-level="10.1" data-path="morphometric-geometric-demo-a-between-group-analysis.html"><a href="morphometric-geometric-demo-a-between-group-analysis.html#before-starting-1"><i class="fa fa-check"></i><b>10.1</b> Before starting</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="morphometric-geometric-demo-a-between-group-analysis.html"><a href="morphometric-geometric-demo-a-between-group-analysis.html#the-morphospace-1"><i class="fa fa-check"></i><b>10.1.1</b> The morphospace</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="morphometric-geometric-demo-a-between-group-analysis.html"><a href="morphometric-geometric-demo-a-between-group-analysis.html#calculating-disparity-2"><i class="fa fa-check"></i><b>10.2</b> Calculating disparity</a></li>
<li class="chapter" data-level="10.3" data-path="morphometric-geometric-demo-a-between-group-analysis.html"><a href="morphometric-geometric-demo-a-between-group-analysis.html#analyse-the-results"><i class="fa fa-check"></i><b>10.3</b> Analyse the results</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="disprity-r-package-manual.html"><a href="disprity-r-package-manual.html"><i class="fa fa-check"></i><b>11</b> dispRity R package manual</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="12" data-path="references-1.html"><a href="references-1.html"><i class="fa fa-check"></i><b>12</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/TGuillerme/dispRity/" target="blank">Project GitHub page</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">dispRity R package manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="other-functionalities" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">6</span> Other functionalities<a href="other-functionalities.html#other-functionalities" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The <code>dispRity</code> package also contains several other functions that are not specific to multidimensional analysis but that are often used by <code>dispRity</code> internal functions.
However, we decided to make these functions also available at a user level since they can be handy for certain specific operations!
You’ll find a brief description of each of them (alphabetically) here:</p>
<div id="char.diff" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> <code>char.diff</code><a href="other-functionalities.html#char.diff" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This is yet another function for calculating distance matrices.
There are many functions for calculating pairwise distance matrices in <code>R</code> (<code>stats::dist</code>, <code>vegan::vegdist</code>, <code>cluster::daisy</code> or <code>Claddis::calculate_morphological_distances</code>) but this one is the <code>dispRity</code> one.
It is slightly different to the ones mentioned above (though not that dissimilar from <code>Claddis::calculate_morphological_distances</code>) in the fact that it focuses on comparing discrete morphological characters and tries to solve all the problems linked to these kind of matrices (especially dealing with special tokens).</p>
<p>The function intakes a matrix with either <code>numeric</code> or <code>integer</code> (<code>NA</code> included) or matrices with <code>character</code> that are indeed <code>integers</code> (e.g.<code>"0"</code> and <code>"1"</code>).
It then uses a <a href="https://en.wikipedia.org/wiki/Bitwise_operations_in_C">bitwise operations</a> architecture implemented in <code>C</code> that renders the function pretty fast and pretty modular.
This bitwise operations translates the character states into binary values.
This way, <code>0</code> becomes <code>1</code>, <code>1</code> becomes <code>2</code>, <code>2</code> becomes <code>4</code>, <code>3</code> becomes <code>8</code>, etc…
Specifically it can handle any rules specific to special tokens (i.e. symbols) for discrete morphological characters. For example, should you treat missing values <code>"?"</code> as <code>NA</code> (ignoring them) or as any possible character state (e.g. <code>c("0", "1")</code>?)? And how to treat characters with a ampersand (<code>"&amp;"</code>)? <code>char.diff</code> can answer to all these questions!</p>
<p>Let’s start by a basic binary matrix 4*3 with random <code>integer</code>:</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="other-functionalities.html#cb435-1" aria-hidden="true"></a><span class="co">## A random binary matrix</span></span>
<span id="cb435-2"><a href="other-functionalities.html#cb435-2" aria-hidden="true"></a>matrix_binary &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">sample</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dv">12</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>), <span class="dt">ncol =</span> <span class="dv">4</span>,</span>
<span id="cb435-3"><a href="other-functionalities.html#cb435-3" aria-hidden="true"></a>                        <span class="dt">dimnames =</span> <span class="kw">list</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], LETTERS[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]))</span></code></pre></div>
<p>By default, <code>char.diff</code> measures the hamming distance between characters:</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="other-functionalities.html#cb436-1" aria-hidden="true"></a><span class="co">## The hamming distance between characters</span></span>
<span id="cb436-2"><a href="other-functionalities.html#cb436-2" aria-hidden="true"></a>(differences &lt;-<span class="st"> </span><span class="kw">char.diff</span>(matrix_binary))</span></code></pre></div>
<pre><code>##   A B C D
## A 0 0 1 1
## B 0 0 1 1
## C 1 1 0 0
## D 1 1 0 0
## attr(,&quot;class&quot;)
## [1] &quot;matrix&quot;    &quot;char.diff&quot;</code></pre>
<p>Note that the results is just a pairwise distance (dissimilarity) matrix with some special dual class <code>matrix</code> and <code>char.diff</code>.
This means it can easily be plotted via the disparity package:</p>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="other-functionalities.html#cb438-1" aria-hidden="true"></a><span class="co">## Visualising the matrix</span></span>
<span id="cb438-2"><a href="other-functionalities.html#cb438-2" aria-hidden="true"></a><span class="kw">plot</span>(differences)</span></code></pre></div>
<p><img src="dispRity_manual_files/figure-html/unnamed-chunk-149-1.png" width="672" /></p>
<p>You can check all the numerous plotting options in the <code>?plot.char.diff</code> manual (it won’t be developed here).</p>
<p>The <code>char.diff</code> function has much more options however (see all of them in the <code>?char.diff</code> manual) for example to measure different differences (via <code>method</code>) or making the comparison work per row (for a distance matrix between the rows):</p>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb439-1"><a href="other-functionalities.html#cb439-1" aria-hidden="true"></a><span class="co">## Euclidean distance between rows</span></span>
<span id="cb439-2"><a href="other-functionalities.html#cb439-2" aria-hidden="true"></a><span class="kw">char.diff</span>(matrix_binary, <span class="dt">by.col =</span> <span class="ot">FALSE</span>, <span class="dt">method =</span> <span class="st">&quot;euclidean&quot;</span>)</span></code></pre></div>
<pre><code>##          a        b        c
## a 0.000000 1.414214 1.414214
## b 1.414214 0.000000 0.000000
## c 1.414214 0.000000 0.000000
## attr(,&quot;class&quot;)
## [1] &quot;matrix&quot;    &quot;char.diff&quot;</code></pre>
<p>We can however make it more interesting by playing with the different rules to play with different tokens.
First let’s create a matrix with morphological characters as numeric <code>character</code>s:</p>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb441-1"><a href="other-functionalities.html#cb441-1" aria-hidden="true"></a><span class="co">## A random character matrix</span></span>
<span id="cb441-2"><a href="other-functionalities.html#cb441-2" aria-hidden="true"></a>(matrix_character &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">&quot;0&quot;</span>,<span class="st">&quot;1&quot;</span>,<span class="st">&quot;2&quot;</span>), <span class="dv">30</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>), <span class="dt">ncol =</span> <span class="dv">5</span>,</span>
<span id="cb441-3"><a href="other-functionalities.html#cb441-3" aria-hidden="true"></a>                           <span class="dt">dimnames =</span> <span class="kw">list</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>], LETTERS[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>])))</span></code></pre></div>
<pre><code>##   A   B   C   D   E  
## a &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;0&quot;
## b &quot;0&quot; &quot;2&quot; &quot;0&quot; &quot;2&quot; &quot;0&quot;
## c &quot;2&quot; &quot;2&quot; &quot;1&quot; &quot;2&quot; &quot;0&quot;
## d &quot;1&quot; &quot;2&quot; &quot;0&quot; &quot;0&quot; &quot;1&quot;
## e &quot;2&quot; &quot;2&quot; &quot;1&quot; &quot;1&quot; &quot;2&quot;
## f &quot;0&quot; &quot;2&quot; &quot;0&quot; &quot;2&quot; &quot;0&quot;</code></pre>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb443-1"><a href="other-functionalities.html#cb443-1" aria-hidden="true"></a><span class="co">## The hamming difference between columns</span></span>
<span id="cb443-2"><a href="other-functionalities.html#cb443-2" aria-hidden="true"></a><span class="kw">char.diff</span>(matrix_character)</span></code></pre></div>
<pre><code>##     A   B   C   D   E
## A 0.0 0.6 0.6 0.6 0.8
## B 0.6 0.0 0.4 0.4 0.8
## C 0.6 0.4 0.0 0.4 0.6
## D 0.6 0.4 0.4 0.0 1.0
## E 0.8 0.8 0.6 1.0 0.0
## attr(,&quot;class&quot;)
## [1] &quot;matrix&quot;    &quot;char.diff&quot;</code></pre>
<p>Here the characters are automatically converted into bitwise integers to be compared efficiently. We can now add some more special tokens like <code>"?"</code> or <code>"0/1"</code> for uncertainties between state <code>"0"</code> and <code>"1"</code> but not <code>"2"</code>:</p>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb445-1"><a href="other-functionalities.html#cb445-1" aria-hidden="true"></a><span class="co">## Adding uncertain characters</span></span>
<span id="cb445-2"><a href="other-functionalities.html#cb445-2" aria-hidden="true"></a>matrix_character[<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">30</span>, <span class="dv">8</span>)] &lt;-<span class="st"> &quot;0/1&quot;</span></span>
<span id="cb445-3"><a href="other-functionalities.html#cb445-3" aria-hidden="true"></a></span>
<span id="cb445-4"><a href="other-functionalities.html#cb445-4" aria-hidden="true"></a><span class="co">## Adding missing data</span></span>
<span id="cb445-5"><a href="other-functionalities.html#cb445-5" aria-hidden="true"></a>matrix_character[<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">30</span>, <span class="dv">5</span>)] &lt;-<span class="st"> &quot;?&quot;</span></span>
<span id="cb445-6"><a href="other-functionalities.html#cb445-6" aria-hidden="true"></a></span>
<span id="cb445-7"><a href="other-functionalities.html#cb445-7" aria-hidden="true"></a><span class="co">## This is what it looks like now</span></span>
<span id="cb445-8"><a href="other-functionalities.html#cb445-8" aria-hidden="true"></a>matrix_character</span></code></pre></div>
<pre><code>##   A   B     C     D     E    
## a &quot;?&quot; &quot;?&quot;   &quot;1&quot;   &quot;1&quot;   &quot;0&quot;  
## b &quot;0&quot; &quot;0/1&quot; &quot;0/1&quot; &quot;0/1&quot; &quot;0&quot;  
## c &quot;2&quot; &quot;2&quot;   &quot;?&quot;   &quot;0/1&quot; &quot;0&quot;  
## d &quot;1&quot; &quot;2&quot;   &quot;0&quot;   &quot;0/1&quot; &quot;1&quot;  
## e &quot;?&quot; &quot;2&quot;   &quot;1&quot;   &quot;1&quot;   &quot;2&quot;  
## f &quot;0&quot; &quot;2&quot;   &quot;0&quot;   &quot;?&quot;   &quot;0/1&quot;</code></pre>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb447-1"><a href="other-functionalities.html#cb447-1" aria-hidden="true"></a><span class="co">## The hamming difference between columns including the special characters</span></span>
<span id="cb447-2"><a href="other-functionalities.html#cb447-2" aria-hidden="true"></a><span class="kw">char.diff</span>(matrix_character)</span></code></pre></div>
<pre><code>##           A         B    C    D         E
## A 0.0000000 0.6666667 1.00 0.50 0.6666667
## B 0.6666667 0.0000000 1.00 1.00 0.7500000
## C 1.0000000 1.0000000 0.00 0.00 0.2500000
## D 0.5000000 1.0000000 0.00 0.00 0.2500000
## E 0.6666667 0.7500000 0.25 0.25 0.0000000
## attr(,&quot;class&quot;)
## [1] &quot;matrix&quot;    &quot;char.diff&quot;</code></pre>
<p>Note here that it detected the default behaviours for the special tokens <code>"?"</code> and <code>"/"</code>: <code>"?"</code> are treated as <code>NA</code> (not compared) and <code>"/"</code> are treated as both states (e.g. <code>"0/1"</code> is treated as <code>"0"</code> and as <code>"1"</code>).
We can specify both the special tokens and the special behaviours to consider via <code>special.tokens</code> and <code>special.behaviours</code>.
The <code>special.tokens</code> are <code>missing = "?"</code>, <code>inapplicable = "-"</code>, <code>uncertainty = "\"</code> and <code>polymorphism = "&amp;"</code> meaning we don’t have to modify them for now.
However, say we want to change the behaviour for <code>"?"</code> and treat them as all possible characters and treat <code>"/"</code> as only the character <code>"0"</code> (as an integer) we can specify them giving a behaviour function:</p>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="other-functionalities.html#cb449-1" aria-hidden="true"></a><span class="co">## Specifying some special behaviours</span></span>
<span id="cb449-2"><a href="other-functionalities.html#cb449-2" aria-hidden="true"></a>my_special_behaviours &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">missing =</span> <span class="cf">function</span>(x,y) <span class="kw">return</span>(y),</span>
<span id="cb449-3"><a href="other-functionalities.html#cb449-3" aria-hidden="true"></a>                              <span class="dt">uncertainty =</span> <span class="cf">function</span>(x,y) <span class="kw">return</span>(<span class="kw">as.integer</span>(<span class="dv">0</span>)))</span>
<span id="cb449-4"><a href="other-functionalities.html#cb449-4" aria-hidden="true"></a></span>
<span id="cb449-5"><a href="other-functionalities.html#cb449-5" aria-hidden="true"></a><span class="co">## Passing these special behaviours to the char.diff function</span></span>
<span id="cb449-6"><a href="other-functionalities.html#cb449-6" aria-hidden="true"></a><span class="kw">char.diff</span>(matrix_character, <span class="dt">special.behaviour =</span> my_special_behaviours)</span></code></pre></div>
<pre><code>##     A   B   C   D   E
## A 0.0 0.6 0.6 0.6 0.6
## B 0.6 0.0 0.8 0.8 0.8
## C 0.6 0.8 0.0 0.4 0.6
## D 0.6 0.8 0.4 0.0 1.0
## E 0.6 0.8 0.6 1.0 0.0
## attr(,&quot;class&quot;)
## [1] &quot;matrix&quot;    &quot;char.diff&quot;</code></pre>
<p>The results are quiet different as before! Note that you can also specify some really specific behaviours for any type of special token.</p>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="other-functionalities.html#cb451-1" aria-hidden="true"></a><span class="co">## Adding weird tokens to the matrix</span></span>
<span id="cb451-2"><a href="other-functionalities.html#cb451-2" aria-hidden="true"></a>matrix_character[<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">30</span>, <span class="dv">8</span>)] &lt;-<span class="st"> &quot;%&quot;</span></span>
<span id="cb451-3"><a href="other-functionalities.html#cb451-3" aria-hidden="true"></a></span>
<span id="cb451-4"><a href="other-functionalities.html#cb451-4" aria-hidden="true"></a><span class="co">## Specify the new token and the new behaviour</span></span>
<span id="cb451-5"><a href="other-functionalities.html#cb451-5" aria-hidden="true"></a><span class="kw">char.diff</span>(matrix_character, <span class="dt">special.tokens =</span> <span class="kw">c</span>(<span class="dt">weird_one =</span> <span class="st">&quot;%&quot;</span>),</span>
<span id="cb451-6"><a href="other-functionalities.html#cb451-6" aria-hidden="true"></a>                            <span class="dt">special.behaviours =</span> <span class="kw">list</span>(</span>
<span id="cb451-7"><a href="other-functionalities.html#cb451-7" aria-hidden="true"></a>                                <span class="dt">weird_one =</span> <span class="cf">function</span>(x,y) <span class="kw">return</span>(<span class="kw">as.integer</span>(<span class="dv">42</span>)))</span>
<span id="cb451-8"><a href="other-functionalities.html#cb451-8" aria-hidden="true"></a>                            )</span></code></pre></div>
<pre><code>##     A   B C D   E
## A   0   1 1 0 NaN
## B   1   0 1 1 NaN
## C   1   1 0 0   0
## D   0   1 0 0   0
## E NaN NaN 0 0   0
## attr(,&quot;class&quot;)
## [1] &quot;matrix&quot;    &quot;char.diff&quot;</code></pre>
<p>Of course the results can be quiet surprising then… But that’s the essence of the modularity. You can see more options in the function manual <code>?char.diff</code>!</p>
</div>
<div id="clean.data" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> <code>clean.data</code><a href="other-functionalities.html#clean.data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This is a rather useful function that allows matching a <code>matrix</code> or a <code>data.frame</code> to a tree (<code>phylo</code>) or a distribution of trees (<code>multiPhylo</code>).
This function outputs the cleaned data and trees (if cleaning was needed) and a list of dropped rows and tips.</p>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="other-functionalities.html#cb453-1" aria-hidden="true"></a><span class="co">## Generating a trees with labels from a to e</span></span>
<span id="cb453-2"><a href="other-functionalities.html#cb453-2" aria-hidden="true"></a>dummy_tree &lt;-<span class="st"> </span><span class="kw">rtree</span>(<span class="dv">5</span>, <span class="dt">tip.label =</span> LETTERS[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>])</span>
<span id="cb453-3"><a href="other-functionalities.html#cb453-3" aria-hidden="true"></a></span>
<span id="cb453-4"><a href="other-functionalities.html#cb453-4" aria-hidden="true"></a><span class="co">## Generating a matrix with rows from b to f</span></span>
<span id="cb453-5"><a href="other-functionalities.html#cb453-5" aria-hidden="true"></a>dummy_data &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">2</span>, <span class="dt">dimnames =</span> <span class="kw">list</span>(LETTERS[<span class="dv">2</span><span class="op">:</span><span class="dv">6</span>], <span class="kw">c</span>(<span class="st">&quot;var1&quot;</span>, <span class="st">&quot;var2&quot;</span>)))</span>
<span id="cb453-6"><a href="other-functionalities.html#cb453-6" aria-hidden="true"></a></span>
<span id="cb453-7"><a href="other-functionalities.html#cb453-7" aria-hidden="true"></a><span class="co">##Cleaning the trees and the data</span></span>
<span id="cb453-8"><a href="other-functionalities.html#cb453-8" aria-hidden="true"></a>(cleaned &lt;-<span class="st"> </span><span class="kw">clean.data</span>(<span class="dt">data =</span> dummy_data, <span class="dt">tree =</span> dummy_tree))</span></code></pre></div>
<pre><code>## $tree
## 
## Phylogenetic tree with 4 tips and 3 internal nodes.
## 
## Tip labels:
##   D, B, E, C
## 
## Rooted; includes branch lengths.
## 
## $data
##   var1 var2
## B    1    1
## C    1    1
## D    1    1
## E    1    1
## 
## $dropped_tips
## [1] &quot;A&quot;
## 
## $dropped_rows
## [1] &quot;F&quot;</code></pre>
</div>
<div id="crown.stem" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> <code>crown.stem</code><a href="other-functionalities.html#crown.stem" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This function quiet handily separates tips from a phylogeny between crown members (the living taxa and their descendants) and their stem members (the fossil taxa without any living relatives).</p>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb455-1"><a href="other-functionalities.html#cb455-1" aria-hidden="true"></a><span class="kw">data</span>(BeckLee_tree)</span>
<span id="cb455-2"><a href="other-functionalities.html#cb455-2" aria-hidden="true"></a><span class="co">## Diving both crow and stem species</span></span>
<span id="cb455-3"><a href="other-functionalities.html#cb455-3" aria-hidden="true"></a>(<span class="kw">crown.stem</span>(BeckLee_tree, <span class="dt">inc.nodes =</span> <span class="ot">FALSE</span>))</span></code></pre></div>
<pre><code>## $crown
##  [1] &quot;Dasypodidae&quot;     &quot;Bradypus&quot;        &quot;Myrmecophagidae&quot; &quot;Todralestes&quot;    
##  [5] &quot;Potamogalinae&quot;   &quot;Dilambdogale&quot;    &quot;Widanelfarasia&quot;  &quot;Rhynchocyon&quot;    
##  [9] &quot;Procavia&quot;        &quot;Moeritherium&quot;    &quot;Pezosiren&quot;       &quot;Trichechus&quot;     
## [13] &quot;Tribosphenomys&quot;  &quot;Paramys&quot;         &quot;Rhombomylus&quot;     &quot;Gomphos&quot;        
## [17] &quot;Mimotona&quot;        &quot;Cynocephalus&quot;    &quot;Purgatorius&quot;     &quot;Plesiadapis&quot;    
## [21] &quot;Notharctus&quot;      &quot;Adapis&quot;          &quot;Patriomanis&quot;     &quot;Protictis&quot;      
## [25] &quot;Vulpavus&quot;        &quot;Miacis&quot;          &quot;Icaronycteris&quot;   &quot;Soricidae&quot;      
## [29] &quot;Solenodon&quot;       &quot;Eoryctes&quot;       
## 
## $stem
##  [1] &quot;Daulestes&quot;              &quot;Bulaklestes&quot;            &quot;Uchkudukodon&quot;          
##  [4] &quot;Kennalestes&quot;            &quot;Asioryctes&quot;             &quot;Ukhaatherium&quot;          
##  [7] &quot;Cimolestes&quot;             &quot;unnamed_cimolestid&quot;     &quot;Maelestes&quot;             
## [10] &quot;Batodon&quot;                &quot;Kulbeckia&quot;              &quot;Zhangolestes&quot;          
## [13] &quot;unnamed_zalambdalestid&quot; &quot;Zalambdalestes&quot;         &quot;Barunlestes&quot;           
## [16] &quot;Gypsonictops&quot;           &quot;Leptictis&quot;              &quot;Oxyclaenus&quot;            
## [19] &quot;Protungulatum&quot;          &quot;Oxyprimus&quot;</code></pre>
<p>Note that it is possible to include or exclude nodes from the output.
To see a more applied example: this function is used in <a href="details-of-specific-functions.html#custom-subsets">chapter 03: specific tutorials</a>.</p>
</div>
<div id="get.bin.ages" class="section level2 hasAnchor" number="6.4">
<h2><span class="header-section-number">6.4</span> <code>get.bin.ages</code><a href="other-functionalities.html#get.bin.ages" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This function is similar than the <code>crown.stem</code> one as it is based on a tree but this one outputs the stratigraphic bins ages that the tree is covering.
This can be useful to generate precise bin ages for the <code>chrono.subsets</code> function:</p>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="other-functionalities.html#cb457-1" aria-hidden="true"></a><span class="kw">get.bin.ages</span>(BeckLee_tree)</span></code></pre></div>
<pre><code>##  [1] 132.9000 129.4000 125.0000 113.0000 100.5000  93.9000  89.8000  86.3000
##  [9]  83.6000  72.1000  66.0000  61.6000  59.2000  56.0000  47.8000  41.2000
## [17]  37.8000  33.9000  28.1000  23.0300  20.4400  15.9700  13.8200  11.6300
## [25]   7.2460   5.3330   3.6000   2.5800   1.8000   0.7810   0.1260   0.0117
## [33]   0.0000</code></pre>
<p>Note that this function outputs the stratigraphic age limits by default but this can be customisable by specifying the <code>type</code> of data (e.g. <code>type = "Eon"</code> for eons).
The function also intakes several optional arguments such as whether to output the startm end, range or midpoint of the stratigraphy or the year of reference of the International Commission of Stratigraphy.
To see a more applied example: this function is used in <a href="details-of-specific-functions.html#chrono-subsets">chapter 03: specific tutorials</a>.</p>
</div>
<div id="match.tip.edge" class="section level2 hasAnchor" number="6.5">
<h2><span class="header-section-number">6.5</span> <code>match.tip.edge</code><a href="other-functionalities.html#match.tip.edge" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This function matches a vector of discreet tip values with the edges connecting these tips in the <code>"phylo"</code> structure.
This can be used to pull the branches of interest for some specific trait of some group of species or for colouring tree tips based on clades.</p>
<p>For example, with the <code>charadriiformes</code> dataset, you can plot the tree with the branches coloured by clade.
To work properly, the function requires the characteristics of the tip labels (e.g. the clade colour) to match the order of the tips in the tree:</p>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="other-functionalities.html#cb459-1" aria-hidden="true"></a><span class="co">## Loading the charadriiformes data</span></span>
<span id="cb459-2"><a href="other-functionalities.html#cb459-2" aria-hidden="true"></a><span class="kw">data</span>(charadriiformes) </span>
<span id="cb459-3"><a href="other-functionalities.html#cb459-3" aria-hidden="true"></a><span class="co">## Extracting the tree</span></span>
<span id="cb459-4"><a href="other-functionalities.html#cb459-4" aria-hidden="true"></a>my_tree &lt;-<span class="st"> </span>charadriiformes<span class="op">$</span>tree</span>
<span id="cb459-5"><a href="other-functionalities.html#cb459-5" aria-hidden="true"></a><span class="co">## Extracting the data column that contains the clade assignments</span></span>
<span id="cb459-6"><a href="other-functionalities.html#cb459-6" aria-hidden="true"></a>my_data &lt;-<span class="st"> </span>charadriiformes<span class="op">$</span>data[, <span class="st">&quot;clade&quot;</span>]</span>
<span id="cb459-7"><a href="other-functionalities.html#cb459-7" aria-hidden="true"></a><span class="co">## Changing the levels names (the clade names) to colours</span></span>
<span id="cb459-8"><a href="other-functionalities.html#cb459-8" aria-hidden="true"></a><span class="kw">levels</span>(my_data) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;orange&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;darkgreen&quot;</span>)</span>
<span id="cb459-9"><a href="other-functionalities.html#cb459-9" aria-hidden="true"></a>my_data &lt;-<span class="st"> </span><span class="kw">as.character</span>(my_data)</span>
<span id="cb459-10"><a href="other-functionalities.html#cb459-10" aria-hidden="true"></a><span class="co">## Matching the data rownames to the tip order in the tree</span></span>
<span id="cb459-11"><a href="other-functionalities.html#cb459-11" aria-hidden="true"></a>my_data &lt;-<span class="st"> </span>my_data[<span class="kw">match</span>(<span class="kw">ladderize</span>(my_tree)<span class="op">$</span>tip.label, <span class="kw">rownames</span>(charadriiformes<span class="op">$</span>data))]</span></code></pre></div>
<p>We can then match this tip data to their common descending edges.
We will also colour the edges that is not descendant directly from a common coloured tip in grey using <code>"replace.na = "grey"</code>.
Note that these edges are usually the edges at the root of the tree that are the descendant edges from multiple clades.</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb460-1"><a href="other-functionalities.html#cb460-1" aria-hidden="true"></a><span class="co">## Matching the tip colours (labels) to their descending edges in the tree</span></span>
<span id="cb460-2"><a href="other-functionalities.html#cb460-2" aria-hidden="true"></a><span class="co">## (and making the non-match edges grey)</span></span>
<span id="cb460-3"><a href="other-functionalities.html#cb460-3" aria-hidden="true"></a>clade_edges &lt;-<span class="st"> </span><span class="kw">match.tip.edge</span>(my_data, my_tree, <span class="dt">replace.na =</span> <span class="st">&quot;grey&quot;</span>)</span>
<span id="cb460-4"><a href="other-functionalities.html#cb460-4" aria-hidden="true"></a></span>
<span id="cb460-5"><a href="other-functionalities.html#cb460-5" aria-hidden="true"></a><span class="co">## Plotting the results</span></span>
<span id="cb460-6"><a href="other-functionalities.html#cb460-6" aria-hidden="true"></a><span class="kw">plot</span>(<span class="kw">ladderize</span>(my_tree), <span class="dt">show.tip.label =</span> <span class="ot">FALSE</span>, <span class="dt">edge.color =</span> clade_edges)</span></code></pre></div>
<p><img src="dispRity_manual_files/figure-html/unnamed-chunk-159-1.png" width="672" /></p>
<p>But you can also use this option to only select some specific edges and modify them (for example making them all equal to one):</p>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="other-functionalities.html#cb461-1" aria-hidden="true"></a><span class="co">## Adding a fixed edge length to the green clade</span></span>
<span id="cb461-2"><a href="other-functionalities.html#cb461-2" aria-hidden="true"></a>my_tree_modif &lt;-<span class="st"> </span>my_tree</span>
<span id="cb461-3"><a href="other-functionalities.html#cb461-3" aria-hidden="true"></a>green_clade &lt;-<span class="st"> </span><span class="kw">which</span>(clade_edges <span class="op">==</span><span class="st"> &quot;darkgreen&quot;</span>)</span>
<span id="cb461-4"><a href="other-functionalities.html#cb461-4" aria-hidden="true"></a>my_tree_modif<span class="op">$</span>edge.length[green_clade] &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb461-5"><a href="other-functionalities.html#cb461-5" aria-hidden="true"></a><span class="kw">plot</span>(<span class="kw">ladderize</span>(my_tree_modif), <span class="dt">show.tip.label =</span> <span class="ot">FALSE</span>,</span>
<span id="cb461-6"><a href="other-functionalities.html#cb461-6" aria-hidden="true"></a>     <span class="dt">edge.color =</span> clade_edges)</span></code></pre></div>
<p><img src="dispRity_manual_files/figure-html/unnamed-chunk-160-1.png" width="672" /></p>
</div>
<div id="MCMCglmm-utilities" class="section level2 hasAnchor" number="6.6">
<h2><span class="header-section-number">6.6</span> <code>MCMCglmm</code> utilities<a href="other-functionalities.html#MCMCglmm-utilities" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Since version <code>1.7</code>, the <code>dispRity</code> package contains several utility functions for manipulating <code>"MCMCglmm"</code> (that is, objects returned by the function <code>MCMCglmm::MCMCglmm</code>).
These objects are a modification of the <code>mcmc</code> object (from the package <code>coda</code>) and can be sometimes cumbersome to manipulate because of the huge amount of data in it.
You can use the functions <code>MCMCglmm.traits</code> for extracting the number of traits, <code>MCMCglmm.levels</code> for extracting the level names, <code>MCMCglmm.sample</code> for sampling posterior IDs and <code>MCMCglmm.covars</code> for extracting variance-covariance matrices. You can also quickly calculate the variance (or relative variance) for each terms in the model using <code>MCMCglmm.variance</code> (the variance is calculated as the sum of the diagonal of each variance-covariance matrix for each term).</p>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb462-1"><a href="other-functionalities.html#cb462-1" aria-hidden="true"></a><span class="co">## Loading the charadriiformes data that contains a MCMCglmm object</span></span>
<span id="cb462-2"><a href="other-functionalities.html#cb462-2" aria-hidden="true"></a><span class="kw">data</span>(charadriiformes)</span>
<span id="cb462-3"><a href="other-functionalities.html#cb462-3" aria-hidden="true"></a>my_MCMCglmm &lt;-<span class="st"> </span>charadriiformes<span class="op">$</span>posteriors</span>
<span id="cb462-4"><a href="other-functionalities.html#cb462-4" aria-hidden="true"></a></span>
<span id="cb462-5"><a href="other-functionalities.html#cb462-5" aria-hidden="true"></a><span class="co">## Which traits where used in this model?</span></span>
<span id="cb462-6"><a href="other-functionalities.html#cb462-6" aria-hidden="true"></a><span class="kw">MCMCglmm.traits</span>(my_MCMCglmm)</span></code></pre></div>
<pre><code>## [1] &quot;PC1&quot; &quot;PC2&quot; &quot;PC3&quot;</code></pre>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="other-functionalities.html#cb464-1" aria-hidden="true"></a><span class="co">## Which levels where used for the model&#39;s random terms and/or residuals?</span></span>
<span id="cb464-2"><a href="other-functionalities.html#cb464-2" aria-hidden="true"></a><span class="kw">MCMCglmm.levels</span>(my_MCMCglmm)</span></code></pre></div>
<pre><code>##           random           random           random           random 
## &quot;animal:clade_1&quot; &quot;animal:clade_2&quot; &quot;animal:clade_3&quot;         &quot;animal&quot; 
##         residual 
##          &quot;units&quot;</code></pre>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="other-functionalities.html#cb466-1" aria-hidden="true"></a><span class="co">## The level names are converted for clarity but you can get them unconverted</span></span>
<span id="cb466-2"><a href="other-functionalities.html#cb466-2" aria-hidden="true"></a><span class="co">## (i.e. as they appear in the model)</span></span>
<span id="cb466-3"><a href="other-functionalities.html#cb466-3" aria-hidden="true"></a><span class="kw">MCMCglmm.levels</span>(my_MCMCglmm, <span class="dt">convert =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>##                                random                                random 
## &quot;us(at.level(clade, 1):trait):animal&quot; &quot;us(at.level(clade, 2):trait):animal&quot; 
##                                random                                random 
## &quot;us(at.level(clade, 3):trait):animal&quot;                    &quot;us(trait):animal&quot; 
##                              residual 
##                     &quot;us(trait):units&quot;</code></pre>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="other-functionalities.html#cb468-1" aria-hidden="true"></a><span class="co">## Sampling 2 random posteriors samples IDs</span></span>
<span id="cb468-2"><a href="other-functionalities.html#cb468-2" aria-hidden="true"></a>(random_samples &lt;-<span class="st"> </span><span class="kw">MCMCglmm.sample</span>(my_MCMCglmm, <span class="dt">n =</span> <span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 749 901</code></pre>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="other-functionalities.html#cb470-1" aria-hidden="true"></a><span class="co">## Extracting these two random samples</span></span>
<span id="cb470-2"><a href="other-functionalities.html#cb470-2" aria-hidden="true"></a>my_covars &lt;-<span class="st"> </span><span class="kw">MCMCglmm.covars</span>(my_MCMCglmm, <span class="dt">sample =</span> random_samples)</span>
<span id="cb470-3"><a href="other-functionalities.html#cb470-3" aria-hidden="true"></a></span>
<span id="cb470-4"><a href="other-functionalities.html#cb470-4" aria-hidden="true"></a><span class="co">## Plotting the variance for each term in the model</span></span>
<span id="cb470-5"><a href="other-functionalities.html#cb470-5" aria-hidden="true"></a><span class="kw">boxplot</span>(<span class="kw">MCMCglmm.variance</span>(my_MCMCglmm), <span class="dt">horizontal =</span> <span class="ot">TRUE</span>, <span class="dt">las =</span> <span class="dv">1</span>,</span>
<span id="cb470-6"><a href="other-functionalities.html#cb470-6" aria-hidden="true"></a>        <span class="dt">xlab =</span> <span class="st">&quot;Relative variance&quot;</span>,</span>
<span id="cb470-7"><a href="other-functionalities.html#cb470-7" aria-hidden="true"></a>        <span class="dt">main =</span> <span class="st">&quot;Variance explained by each term&quot;</span>)</span></code></pre></div>
<p><img src="dispRity_manual_files/figure-html/unnamed-chunk-161-1.png" width="672" /></p>
<p>See more in the <a href="details-of-specific-functions.html#covar"><code>$covar</code> section</a> on what to do with these <code>"MCMCglmm"</code> objects.</p>
</div>
<div id="pair.plot" class="section level2 hasAnchor" number="6.7">
<h2><span class="header-section-number">6.7</span> <code>pair.plot</code><a href="other-functionalities.html#pair.plot" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This utility function allows to plot a matrix image of pairwise comparisons.
This can be useful when getting pairwise comparisons and if you’d like to see at a glance which pairs of comparisons have high or low values.</p>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="other-functionalities.html#cb471-1" aria-hidden="true"></a><span class="co">## Random data</span></span>
<span id="cb471-2"><a href="other-functionalities.html#cb471-2" aria-hidden="true"></a>data &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dt">data =</span> <span class="kw">runif</span>(<span class="dv">42</span>), <span class="dt">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb471-3"><a href="other-functionalities.html#cb471-3" aria-hidden="true"></a></span>
<span id="cb471-4"><a href="other-functionalities.html#cb471-4" aria-hidden="true"></a><span class="co">## Plotting the first column as a pairwise comparisons</span></span>
<span id="cb471-5"><a href="other-functionalities.html#cb471-5" aria-hidden="true"></a><span class="kw">pair.plot</span>(data, <span class="dt">what =</span> <span class="dv">1</span>, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;orange&quot;</span>, <span class="st">&quot;blue&quot;</span>), <span class="dt">legend =</span> <span class="ot">TRUE</span>,</span>
<span id="cb471-6"><a href="other-functionalities.html#cb471-6" aria-hidden="true"></a>          <span class="dt">diag =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="dispRity_manual_files/figure-html/unnamed-chunk-162-1.png" width="672" /></p>
<p>Here blue squares are ones that have a high value and orange ones the ones that have low values.
Note that the values plotted correspond the first column of the data as designated by <code>what = 1</code>.</p>
<p>It is also possible to add some tokens or symbols to quickly highlight to specific cells, for example which elements in the data are below a certain value:</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="other-functionalities.html#cb472-1" aria-hidden="true"></a><span class="co">## The same plot as before without the diagonal being</span></span>
<span id="cb472-2"><a href="other-functionalities.html#cb472-2" aria-hidden="true"></a><span class="co">## the maximal observed value</span></span>
<span id="cb472-3"><a href="other-functionalities.html#cb472-3" aria-hidden="true"></a><span class="kw">pair.plot</span>(data, <span class="dt">what =</span> <span class="dv">1</span>, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;orange&quot;</span>, <span class="st">&quot;blue&quot;</span>), <span class="dt">legend =</span> <span class="ot">TRUE</span>,</span>
<span id="cb472-4"><a href="other-functionalities.html#cb472-4" aria-hidden="true"></a>          <span class="dt">diag =</span> <span class="st">&quot;max&quot;</span>)</span>
<span id="cb472-5"><a href="other-functionalities.html#cb472-5" aria-hidden="true"></a><span class="co">## Highlighting with an asterisk which squares have a value</span></span>
<span id="cb472-6"><a href="other-functionalities.html#cb472-6" aria-hidden="true"></a><span class="co">## below 0.2</span></span>
<span id="cb472-7"><a href="other-functionalities.html#cb472-7" aria-hidden="true"></a><span class="kw">pair.plot</span>(data, <span class="dt">what =</span> <span class="dv">1</span>, <span class="dt">binary =</span> <span class="fl">0.2</span>, <span class="dt">add =</span> <span class="st">&quot;*&quot;</span>, <span class="dt">cex =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="dispRity_manual_files/figure-html/unnamed-chunk-163-1.png" width="672" /></p>
<p>This function can also be used as a binary display when running a series of pairwise t-tests.
For example, the following script runs a wilcoxon test between the time-slices from the <code>disparity</code> example dataset and displays in black which pairs of slices have a p-value below 0.05:</p>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="other-functionalities.html#cb473-1" aria-hidden="true"></a><span class="co">## Loading disparity data</span></span>
<span id="cb473-2"><a href="other-functionalities.html#cb473-2" aria-hidden="true"></a><span class="kw">data</span>(disparity)</span>
<span id="cb473-3"><a href="other-functionalities.html#cb473-3" aria-hidden="true"></a></span>
<span id="cb473-4"><a href="other-functionalities.html#cb473-4" aria-hidden="true"></a><span class="co">## Testing the pairwise difference between slices</span></span>
<span id="cb473-5"><a href="other-functionalities.html#cb473-5" aria-hidden="true"></a>tests &lt;-<span class="st"> </span><span class="kw">test.dispRity</span>(disparity, <span class="dt">test =</span> wilcox.test, <span class="dt">correction =</span> <span class="st">&quot;bonferroni&quot;</span>)</span>
<span id="cb473-6"><a href="other-functionalities.html#cb473-6" aria-hidden="true"></a></span>
<span id="cb473-7"><a href="other-functionalities.html#cb473-7" aria-hidden="true"></a><span class="co">## Plotting the significance</span></span>
<span id="cb473-8"><a href="other-functionalities.html#cb473-8" aria-hidden="true"></a><span class="kw">pair.plot</span>(<span class="kw">as.data.frame</span>(tests), <span class="dt">what =</span> <span class="st">&quot;p.value&quot;</span>, <span class="dt">binary =</span> <span class="fl">0.05</span>)</span></code></pre></div>
<p><img src="dispRity_manual_files/figure-html/unnamed-chunk-164-1.png" width="672" /></p>
</div>
<div id="reduce.matrix" class="section level2 hasAnchor" number="6.8">
<h2><span class="header-section-number">6.8</span> <code>reduce.matrix</code><a href="other-functionalities.html#reduce.matrix" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This function allows to reduce columns or rows of a matrix to make sure that there is enough overlap for further analysis.
This is particularly useful if you are going to use distance matrices since it uses the <code>vegan::vegdist</code> function to test whether distances can be calculated or not.</p>
<p>For example, if we have a patchy matrix like so (where the black squares represent available data):</p>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="other-functionalities.html#cb474-1" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb474-2"><a href="other-functionalities.html#cb474-2" aria-hidden="true"></a><span class="co">## A 10*5 matrix</span></span>
<span id="cb474-3"><a href="other-functionalities.html#cb474-3" aria-hidden="true"></a>na_matrix &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">50</span>), <span class="dv">10</span>, <span class="dv">5</span>)</span>
<span id="cb474-4"><a href="other-functionalities.html#cb474-4" aria-hidden="true"></a><span class="co">## Making sure some rows don&#39;t overlap</span></span>
<span id="cb474-5"><a href="other-functionalities.html#cb474-5" aria-hidden="true"></a>na_matrix[<span class="dv">1</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb474-6"><a href="other-functionalities.html#cb474-6" aria-hidden="true"></a>na_matrix[<span class="dv">2</span>, <span class="dv">3</span><span class="op">:</span><span class="dv">5</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb474-7"><a href="other-functionalities.html#cb474-7" aria-hidden="true"></a><span class="co">## Adding 50% NAs</span></span>
<span id="cb474-8"><a href="other-functionalities.html#cb474-8" aria-hidden="true"></a>na_matrix[<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">50</span>, <span class="dv">25</span>)] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb474-9"><a href="other-functionalities.html#cb474-9" aria-hidden="true"></a><span class="co">## Illustrating the gappy matrix</span></span>
<span id="cb474-10"><a href="other-functionalities.html#cb474-10" aria-hidden="true"></a><span class="kw">image</span>(<span class="kw">t</span>(na_matrix), <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<p><img src="dispRity_manual_files/figure-html/unnamed-chunk-165-1.png" width="672" /></p>
<p>We can use the <code>reduce.matrix</code> to double check whether any rows cannot be compared.
The functions needs as an input the type of distance that will be used, say a <code>"gower"</code> distance:</p>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="other-functionalities.html#cb475-1" aria-hidden="true"></a><span class="co">## Reducing the matrix by row</span></span>
<span id="cb475-2"><a href="other-functionalities.html#cb475-2" aria-hidden="true"></a>(reduction &lt;-<span class="st"> </span><span class="kw">reduce.matrix</span>(na_matrix, <span class="dt">distance =</span> <span class="st">&quot;gower&quot;</span>))</span></code></pre></div>
<pre><code>## $rows.to.remove
## [1] &quot;9&quot; &quot;1&quot;
## 
## $cols.to.remove
## NULL</code></pre>
<p>We can not remove the rows 1 and 9 and see if that improved the overlap:</p>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="other-functionalities.html#cb477-1" aria-hidden="true"></a><span class="kw">image</span>(<span class="kw">t</span>(na_matrix[<span class="op">-</span><span class="kw">as.numeric</span>(reduction<span class="op">$</span>rows.to.remove), ]),</span>
<span id="cb477-2"><a href="other-functionalities.html#cb477-2" aria-hidden="true"></a>      <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<p><img src="dispRity_manual_files/figure-html/unnamed-chunk-167-1.png" width="672" /></p>
</div>
<div id="select.axes" class="section level2 hasAnchor" number="6.9">
<h2><span class="header-section-number">6.9</span> <code>select.axes</code><a href="other-functionalities.html#select.axes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This function allows you to select which axes (or how many of them) are relevant in your trait space analyses.
Usually, when the trait space is an ordination, workers select a certain number of axes to reduce the dimensionality of the dataset by removing axes that contain relatively little information.
This is often done by selecting the axes from which the cumulative individual variance is lower than an arbitrary threshold.
For example, all the axes that contain together 0.95 of the variance:</p>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="other-functionalities.html#cb478-1" aria-hidden="true"></a><span class="co">## The USArrest example in R</span></span>
<span id="cb478-2"><a href="other-functionalities.html#cb478-2" aria-hidden="true"></a>ordination &lt;-<span class="st"> </span><span class="kw">princomp</span>(USArrests, <span class="dt">cor =</span> <span class="ot">TRUE</span>)</span>
<span id="cb478-3"><a href="other-functionalities.html#cb478-3" aria-hidden="true"></a></span>
<span id="cb478-4"><a href="other-functionalities.html#cb478-4" aria-hidden="true"></a><span class="co">## The loading of each variable</span></span>
<span id="cb478-5"><a href="other-functionalities.html#cb478-5" aria-hidden="true"></a><span class="kw">loadings</span>(ordination)</span></code></pre></div>
<pre><code>## 
## Loadings:
##          Comp.1 Comp.2 Comp.3 Comp.4
## Murder    0.536  0.418  0.341  0.649
## Assault   0.583  0.188  0.268 -0.743
## UrbanPop  0.278 -0.873  0.378  0.134
## Rape      0.543 -0.167 -0.818       
## 
##                Comp.1 Comp.2 Comp.3 Comp.4
## SS loadings      1.00   1.00   1.00   1.00
## Proportion Var   0.25   0.25   0.25   0.25
## Cumulative Var   0.25   0.50   0.75   1.00</code></pre>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb480-1"><a href="other-functionalities.html#cb480-1" aria-hidden="true"></a><span class="co">## Or the same operation but manually</span></span>
<span id="cb480-2"><a href="other-functionalities.html#cb480-2" aria-hidden="true"></a>variances &lt;-<span class="st"> </span><span class="kw">apply</span>(ordination<span class="op">$</span>scores, <span class="dv">2</span>, var)</span>
<span id="cb480-3"><a href="other-functionalities.html#cb480-3" aria-hidden="true"></a>scaled_variances &lt;-<span class="st"> </span>variances<span class="op">/</span><span class="kw">sum</span>(variances)</span>
<span id="cb480-4"><a href="other-functionalities.html#cb480-4" aria-hidden="true"></a>sumed_variances &lt;-<span class="st"> </span><span class="kw">cumsum</span>(scaled_variances)</span>
<span id="cb480-5"><a href="other-functionalities.html#cb480-5" aria-hidden="true"></a><span class="kw">round</span>(<span class="kw">rbind</span>(variances, scaled_variances, sumed_variances), <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##                  Comp.1 Comp.2 Comp.3 Comp.4
## variances         2.531  1.010  0.364  0.177
## scaled_variances  0.620  0.247  0.089  0.043
## sumed_variances   0.620  0.868  0.957  1.000</code></pre>
<p>In this example, you can see that the three first axes are required to have at least 0.95 of the variance.
You can do that automatically in <code>dispRity</code> using the <code>select.axes</code> function.</p>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="other-functionalities.html#cb482-1" aria-hidden="true"></a><span class="co">## Same operation automatised</span></span>
<span id="cb482-2"><a href="other-functionalities.html#cb482-2" aria-hidden="true"></a>(selected &lt;-<span class="st"> </span><span class="kw">select.axes</span>(ordination))</span></code></pre></div>
<pre><code>## The first 3 dimensions are needed to express at least 95% of the variance in the whole trait space.
## You can use x$dimensions to select them or use plot(x) and summary(x) to summarise them.</code></pre>
<p>This function does basically what the script above does and allows the results to be plotted or summarised into a table.</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb484-1"><a href="other-functionalities.html#cb484-1" aria-hidden="true"></a><span class="co">## Summarising this info</span></span>
<span id="cb484-2"><a href="other-functionalities.html#cb484-2" aria-hidden="true"></a><span class="kw">summary</span>(selected)</span></code></pre></div>
<pre><code>##             Comp.1.var Comp.1.sum Comp.2.var Comp.2.sum Comp.3.var Comp.3.sum
## whole_space       0.62       0.62      0.247      0.868      0.089      0.957
##             Comp.4.var Comp.4.sum
## whole_space      0.043          1</code></pre>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="other-functionalities.html#cb486-1" aria-hidden="true"></a><span class="co">## Plotting it</span></span>
<span id="cb486-2"><a href="other-functionalities.html#cb486-2" aria-hidden="true"></a><span class="kw">plot</span>(selected)</span></code></pre></div>
<p><img src="dispRity_manual_files/figure-html/unnamed-chunk-170-1.png" width="672" /></p>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb487-1"><a href="other-functionalities.html#cb487-1" aria-hidden="true"></a><span class="co">## Extracting the dimensions</span></span>
<span id="cb487-2"><a href="other-functionalities.html#cb487-2" aria-hidden="true"></a><span class="co">## (for the dispRity function for example)</span></span>
<span id="cb487-3"><a href="other-functionalities.html#cb487-3" aria-hidden="true"></a>selected<span class="op">$</span>dimensions</span></code></pre></div>
<pre><code>## [1] 1 2 3</code></pre>
<p>However, it might be interesting to not only consider the variance within the whole trait space but also among groups of specific interest.
E.g. if the 95% of the variance is concentrated in the two first axes for the whole trait space, that does not automatically mean that it is the case for each subset in this space. Some subset might require more than the two first axes to express 95% of their variance!
You can thus use the <code>select.axes</code> function to look at the results per group as well as through the whole trait space.</p>
<blockquote>
<p>Note that you can always change the threshold value (default is 0.95). Here for example we set it to 0.9 (we arbitrarily decide that explain 90% of the variance is enough).</p>
</blockquote>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb489-1"><a href="other-functionalities.html#cb489-1" aria-hidden="true"></a><span class="co">## Creating some groups of stats</span></span>
<span id="cb489-2"><a href="other-functionalities.html#cb489-2" aria-hidden="true"></a>states_groups &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;Group1&quot;</span> =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Mississippi&quot;</span>,<span class="st">&quot;North Carolina&quot;</span>,</span>
<span id="cb489-3"><a href="other-functionalities.html#cb489-3" aria-hidden="true"></a>                                   <span class="st">&quot;South Carolina&quot;</span>, <span class="st">&quot;Georgia&quot;</span>, <span class="st">&quot;Alabama&quot;</span>,</span>
<span id="cb489-4"><a href="other-functionalities.html#cb489-4" aria-hidden="true"></a>                                   <span class="st">&quot;Alaska&quot;</span>, <span class="st">&quot;Tennessee&quot;</span>, <span class="st">&quot;Louisiana&quot;</span>),</span>
<span id="cb489-5"><a href="other-functionalities.html#cb489-5" aria-hidden="true"></a>                      <span class="st">&quot;Group2&quot;</span> =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Florida&quot;</span>, <span class="st">&quot;New Mexico&quot;</span>, <span class="st">&quot;Michigan&quot;</span>,</span>
<span id="cb489-6"><a href="other-functionalities.html#cb489-6" aria-hidden="true"></a>                                   <span class="st">&quot;Indiana&quot;</span>, <span class="st">&quot;Virginia&quot;</span>, <span class="st">&quot;Wyoming&quot;</span>, <span class="st">&quot;Montana&quot;</span>,</span>
<span id="cb489-7"><a href="other-functionalities.html#cb489-7" aria-hidden="true"></a>                                   <span class="st">&quot;Maine&quot;</span>, <span class="st">&quot;Idaho&quot;</span>, <span class="st">&quot;New Hampshire&quot;</span>, <span class="st">&quot;Iowa&quot;</span>),</span>
<span id="cb489-8"><a href="other-functionalities.html#cb489-8" aria-hidden="true"></a>                      <span class="st">&quot;Group3&quot;</span> =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Rhode Island&quot;</span>, <span class="st">&quot;New Jersey&quot;</span>, <span class="st">&quot;Hawaii&quot;</span>, <span class="st">&quot;Massachusetts&quot;</span>))</span>
<span id="cb489-9"><a href="other-functionalities.html#cb489-9" aria-hidden="true"></a><span class="co">## Running the same analyses but per groups</span></span>
<span id="cb489-10"><a href="other-functionalities.html#cb489-10" aria-hidden="true"></a>selected &lt;-<span class="st"> </span><span class="kw">select.axes</span>(ordination, <span class="dt">group =</span> states_groups, <span class="dt">threshold =</span> <span class="fl">0.9</span>)</span>
<span id="cb489-11"><a href="other-functionalities.html#cb489-11" aria-hidden="true"></a><span class="co">## Plotting the results</span></span>
<span id="cb489-12"><a href="other-functionalities.html#cb489-12" aria-hidden="true"></a><span class="kw">plot</span>(selected)</span></code></pre></div>
<p><img src="dispRity_manual_files/figure-html/unnamed-chunk-171-1.png" width="672" /></p>
<p>As you can see here, the whole space requires the three first axes to explain at least 90% of the variance (in fact, 95% as seen before).
However, different groups have a different story!
The Group 1 and 3 requires 4 dimensions whereas Group 2 requires only 1 dimensions (note how for Group 3, there is actually nearly no variance explained on the second axes)!
Using this method, you can safely use the four axes returned by the function (<code>selected$dimensions</code>) so that every group has at least 90% of their variance explained in the trait space.</p>
<p>If you’ve used the function if you’ve already done some grouping in your disparity analyses (e.g. using the function <code>custom.subsets</code> or <code>chrono.subsets</code>), you can use the generated <code>dispRity</code> to automatise this analyses:</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="other-functionalities.html#cb490-1" aria-hidden="true"></a><span class="co">## Loading the dispRity package demo data</span></span>
<span id="cb490-2"><a href="other-functionalities.html#cb490-2" aria-hidden="true"></a><span class="kw">data</span>(demo_data)</span>
<span id="cb490-3"><a href="other-functionalities.html#cb490-3" aria-hidden="true"></a><span class="co">## A dispRity object with two groups</span></span>
<span id="cb490-4"><a href="other-functionalities.html#cb490-4" aria-hidden="true"></a>demo_data<span class="op">$</span>hopkins</span></code></pre></div>
<pre><code>##  ---- dispRity object ---- 
## 2 customised subsets for 46 elements in one matrix:
##     adult, juvenile.</code></pre>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="other-functionalities.html#cb492-1" aria-hidden="true"></a><span class="co">## Selecting axes on a dispRity object</span></span>
<span id="cb492-2"><a href="other-functionalities.html#cb492-2" aria-hidden="true"></a>selected &lt;-<span class="st"> </span><span class="kw">select.axes</span>(demo_data<span class="op">$</span>hopkins)</span>
<span id="cb492-3"><a href="other-functionalities.html#cb492-3" aria-hidden="true"></a><span class="kw">plot</span>(selected)</span></code></pre></div>
<p><img src="dispRity_manual_files/figure-html/unnamed-chunk-172-1.png" width="672" /></p>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb493-1"><a href="other-functionalities.html#cb493-1" aria-hidden="true"></a><span class="co">## Displaying which axes are necessary for which group</span></span>
<span id="cb493-2"><a href="other-functionalities.html#cb493-2" aria-hidden="true"></a>selected<span class="op">$</span>dim.list</span></code></pre></div>
<pre><code>## $adult
##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22
## 
## $juvenile
##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23
## 
## $whole_space
##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16</code></pre>
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb495-1"><a href="other-functionalities.html#cb495-1" aria-hidden="true"></a><span class="co">## Note how the whole space needs only 16 axes</span></span>
<span id="cb495-2"><a href="other-functionalities.html#cb495-2" aria-hidden="true"></a><span class="co">## but both groups need 22 and 23 axes</span></span></code></pre></div>
</div>
<div id="set.root.time" class="section level2 hasAnchor" number="6.10">
<h2><span class="header-section-number">6.10</span> <code>set.root.time</code><a href="other-functionalities.html#set.root.time" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This function can be used to easily add a <code>$root.time</code> element to <code>"phylo"</code> or <code>"multiPhylo"</code> objects.
This <code>$root.time</code> element is used by <code>dispRity</code> and several packages (e.g. <code>Claddis</code> and <code>paleotree</code>) to scale the branch length units of a tree allowing them to be usually expressed in million of years (Mya).</p>
<p>For example, on a standard random tree, no <code>$root.time</code> exist so the edge lengths are not expressed in any specific unit:</p>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb496-1"><a href="other-functionalities.html#cb496-1" aria-hidden="true"></a><span class="co">## A random tree with no root.time</span></span>
<span id="cb496-2"><a href="other-functionalities.html#cb496-2" aria-hidden="true"></a>my_tree &lt;-<span class="st"> </span><span class="kw">rtree</span>(<span class="dv">10</span>)</span>
<span id="cb496-3"><a href="other-functionalities.html#cb496-3" aria-hidden="true"></a>my_tree<span class="op">$</span>root.time <span class="co"># is NULL</span></span></code></pre></div>
<pre><code>## NULL</code></pre>
<p>You can add a root time by either manually setting it:</p>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb498-1"><a href="other-functionalities.html#cb498-1" aria-hidden="true"></a><span class="co">## Adding an arbitrary root time</span></span>
<span id="cb498-2"><a href="other-functionalities.html#cb498-2" aria-hidden="true"></a>my_tree_arbitrary &lt;-<span class="st"> </span>my_tree</span>
<span id="cb498-3"><a href="other-functionalities.html#cb498-3" aria-hidden="true"></a><span class="co">## Setting the age of the root to 42</span></span>
<span id="cb498-4"><a href="other-functionalities.html#cb498-4" aria-hidden="true"></a>my_tree_arbitrary<span class="op">$</span>root.time &lt;-<span class="st"> </span><span class="dv">42</span></span></code></pre></div>
<p>Or by calculating it automatically from the cumulated branch length information (making the youngest tip age 0 and the oldest the total age/depth of the tree)</p>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb499-1"><a href="other-functionalities.html#cb499-1" aria-hidden="true"></a><span class="co">## Calculating the root time from the present</span></span>
<span id="cb499-2"><a href="other-functionalities.html#cb499-2" aria-hidden="true"></a>my_tree_aged &lt;-<span class="st"> </span>my_tree </span>
<span id="cb499-3"><a href="other-functionalities.html#cb499-3" aria-hidden="true"></a>my_tree_aged &lt;-<span class="st"> </span><span class="kw">set.root.time</span>(my_tree)</span></code></pre></div>
<p>If you want the youngest tip to not be of age 0, you can define an arbitrary age for it and recalculate the age of the root from there using the <code>present</code> argument (say the youngest tip is 42 Mya old):</p>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb500-1"><a href="other-functionalities.html#cb500-1" aria-hidden="true"></a><span class="co">## Caculating the root time from 42 Mya </span></span>
<span id="cb500-2"><a href="other-functionalities.html#cb500-2" aria-hidden="true"></a>my_tree_age &lt;-<span class="st"> </span><span class="kw">set.root.time</span>(my_tree, <span class="dt">present =</span> <span class="dv">42</span>)</span></code></pre></div>
<p>This function also works with a distribution of trees (<code>"multiPhylo"</code>).</p>
</div>
<div id="slice.tree" class="section level2 hasAnchor" number="6.11">
<h2><span class="header-section-number">6.11</span> <code>slice.tree</code><a href="other-functionalities.html#slice.tree" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This function is a modification of the <code>paleotree::timeSliceTree</code> function that allows to make slices through a phylogenetic tree.
Compared to the <code>paleotree::timeSliceTree</code>, this function allows a model to decide which tip or node to use when slicing through a branch (whereas <code>paleotree::timeSliceTree</code> always choose the first available tip alphabetically).
The models for choosing which tip or node are the same as the ones used in the <code>chrono.subsets</code> and are described in <a href="details-of-specific-functions.html#chrono-subsets">chapter 03: specific tutorials</a>.</p>
<p>The function works by using at least a tree, a slice age and a model:</p>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="other-functionalities.html#cb501-1" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb501-2"><a href="other-functionalities.html#cb501-2" aria-hidden="true"></a><span class="co">## Generate a random ultrametric tree</span></span>
<span id="cb501-3"><a href="other-functionalities.html#cb501-3" aria-hidden="true"></a>tree &lt;-<span class="st"> </span><span class="kw">rcoal</span>(<span class="dv">20</span>)</span>
<span id="cb501-4"><a href="other-functionalities.html#cb501-4" aria-hidden="true"></a><span class="co">## Add some node labels</span></span>
<span id="cb501-5"><a href="other-functionalities.html#cb501-5" aria-hidden="true"></a>tree<span class="op">$</span>node.label &lt;-<span class="st"> </span>letters[<span class="dv">1</span><span class="op">:</span><span class="dv">19</span>]</span>
<span id="cb501-6"><a href="other-functionalities.html#cb501-6" aria-hidden="true"></a><span class="co">## Add its root time</span></span>
<span id="cb501-7"><a href="other-functionalities.html#cb501-7" aria-hidden="true"></a>tree<span class="op">$</span>root.time &lt;-<span class="st"> </span><span class="kw">max</span>(<span class="kw">tree.age</span>(tree)<span class="op">$</span>ages)</span>
<span id="cb501-8"><a href="other-functionalities.html#cb501-8" aria-hidden="true"></a></span>
<span id="cb501-9"><a href="other-functionalities.html#cb501-9" aria-hidden="true"></a><span class="co">## Slicing the tree at age 0.75</span></span>
<span id="cb501-10"><a href="other-functionalities.html#cb501-10" aria-hidden="true"></a>tree_<span class="dv">75</span> &lt;-<span class="st"> </span><span class="kw">slice.tree</span>(tree, <span class="dt">age =</span> <span class="fl">0.75</span>, <span class="st">&quot;acctran&quot;</span>)</span>
<span id="cb501-11"><a href="other-functionalities.html#cb501-11" aria-hidden="true"></a></span>
<span id="cb501-12"><a href="other-functionalities.html#cb501-12" aria-hidden="true"></a><span class="co">## Showing both trees</span></span>
<span id="cb501-13"><a href="other-functionalities.html#cb501-13" aria-hidden="true"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb501-14"><a href="other-functionalities.html#cb501-14" aria-hidden="true"></a><span class="kw">plot</span>(tree, <span class="dt">main =</span> <span class="st">&quot;original tree&quot;</span>)</span>
<span id="cb501-15"><a href="other-functionalities.html#cb501-15" aria-hidden="true"></a><span class="kw">axisPhylo</span>() ; <span class="kw">nodelabels</span>(tree<span class="op">$</span>node.label, <span class="dt">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb501-16"><a href="other-functionalities.html#cb501-16" aria-hidden="true"></a><span class="kw">abline</span>(<span class="dt">v =</span> (<span class="kw">max</span>(<span class="kw">tree.age</span>(tree)<span class="op">$</span>ages) <span class="op">-</span><span class="st"> </span><span class="fl">0.75</span>), <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb501-17"><a href="other-functionalities.html#cb501-17" aria-hidden="true"></a><span class="kw">plot</span>(tree_<span class="dv">75</span>, <span class="dt">main =</span> <span class="st">&quot;sliced tree&quot;</span>)</span></code></pre></div>
<p><img src="dispRity_manual_files/figure-html/unnamed-chunk-177-1.png" width="672" /></p>
</div>
<div id="slide.nodes-and-remove.zero.brlen" class="section level2 hasAnchor" number="6.12">
<h2><span class="header-section-number">6.12</span> <code>slide.nodes</code> and <code>remove.zero.brlen</code><a href="other-functionalities.html#slide.nodes-and-remove.zero.brlen" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This function allows to slide nodes along a tree!
In other words it allows to change the branch length leading to a node without modifying the overall tree shape.
This can be useful to add some value to 0 branch lengths for example.</p>
<p>The function works by taking a node (or a list of nodes), a tree and a sliding value.
The node will be moved “up” (towards the tips) for the given sliding value.
You can move the node “down” (towards the roots) using a negative value.</p>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb502-1"><a href="other-functionalities.html#cb502-1" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb502-2"><a href="other-functionalities.html#cb502-2" aria-hidden="true"></a><span class="co">## Generating simple coalescent tree</span></span>
<span id="cb502-3"><a href="other-functionalities.html#cb502-3" aria-hidden="true"></a>tree &lt;-<span class="st"> </span><span class="kw">rcoal</span>(<span class="dv">5</span>)</span>
<span id="cb502-4"><a href="other-functionalities.html#cb502-4" aria-hidden="true"></a></span>
<span id="cb502-5"><a href="other-functionalities.html#cb502-5" aria-hidden="true"></a><span class="co">## Sliding node 8 up and down</span></span>
<span id="cb502-6"><a href="other-functionalities.html#cb502-6" aria-hidden="true"></a>tree_slide_up &lt;-<span class="st"> </span><span class="kw">slide.nodes</span>(<span class="dv">8</span>, tree, <span class="dt">slide =</span> <span class="fl">0.075</span>)</span>
<span id="cb502-7"><a href="other-functionalities.html#cb502-7" aria-hidden="true"></a>tree_slide_down &lt;-<span class="st"> </span><span class="kw">slide.nodes</span>(<span class="dv">8</span>, tree, <span class="dt">slide =</span> <span class="fl">-0.075</span>)</span>
<span id="cb502-8"><a href="other-functionalities.html#cb502-8" aria-hidden="true"></a></span>
<span id="cb502-9"><a href="other-functionalities.html#cb502-9" aria-hidden="true"></a><span class="co">## Display the results</span></span>
<span id="cb502-10"><a href="other-functionalities.html#cb502-10" aria-hidden="true"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">1</span>))</span>
<span id="cb502-11"><a href="other-functionalities.html#cb502-11" aria-hidden="true"></a><span class="kw">plot</span>(tree, <span class="dt">main =</span> <span class="st">&quot;original tree&quot;</span>) ; <span class="kw">axisPhylo</span>() ; <span class="kw">nodelabels</span>()</span>
<span id="cb502-12"><a href="other-functionalities.html#cb502-12" aria-hidden="true"></a><span class="kw">plot</span>(tree_slide_up, <span class="dt">main =</span> <span class="st">&quot;slide up!&quot;</span>) ; <span class="kw">axisPhylo</span>() ; <span class="kw">nodelabels</span>()</span>
<span id="cb502-13"><a href="other-functionalities.html#cb502-13" aria-hidden="true"></a><span class="kw">plot</span>(tree_slide_down, <span class="dt">main =</span> <span class="st">&quot;slide down!&quot;</span>) ; <span class="kw">axisPhylo</span>() ; <span class="kw">nodelabels</span>()</span></code></pre></div>
<p><img src="dispRity_manual_files/figure-html/unnamed-chunk-178-1.png" width="672" /></p>
<p>The <code>remove.zero.brlen</code> is a “clever” wrapping function that uses the <code>slide.nodes</code> function to stochastically remove zero branch lengths across a whole tree.
This function will slide nodes up or down in successive postorder traversals (i.e. going down the tree clade by clade) in order to minimise the number of nodes to slide while making sure there are no silly negative branch lengths produced!
By default it is trying to slide the nodes using 1% of the minimum branch length to avoid changing the topology too much.</p>
<div class="sourceCode" id="cb503"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb503-1"><a href="other-functionalities.html#cb503-1" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb503-2"><a href="other-functionalities.html#cb503-2" aria-hidden="true"></a><span class="co">## Generating a tree</span></span>
<span id="cb503-3"><a href="other-functionalities.html#cb503-3" aria-hidden="true"></a>tree &lt;-<span class="st"> </span><span class="kw">rtree</span>(<span class="dv">20</span>)</span>
<span id="cb503-4"><a href="other-functionalities.html#cb503-4" aria-hidden="true"></a></span>
<span id="cb503-5"><a href="other-functionalities.html#cb503-5" aria-hidden="true"></a><span class="co">## Adding some zero branch lengths (5)</span></span>
<span id="cb503-6"><a href="other-functionalities.html#cb503-6" aria-hidden="true"></a>tree<span class="op">$</span>edge.length[<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">Nedge</span>(tree), <span class="dv">5</span>)] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb503-7"><a href="other-functionalities.html#cb503-7" aria-hidden="true"></a></span>
<span id="cb503-8"><a href="other-functionalities.html#cb503-8" aria-hidden="true"></a><span class="co">## And now removing these zero branch lengths!</span></span>
<span id="cb503-9"><a href="other-functionalities.html#cb503-9" aria-hidden="true"></a>tree_no_zero &lt;-<span class="st"> </span><span class="kw">remove.zero.brlen</span>(tree)</span>
<span id="cb503-10"><a href="other-functionalities.html#cb503-10" aria-hidden="true"></a></span>
<span id="cb503-11"><a href="other-functionalities.html#cb503-11" aria-hidden="true"></a><span class="co">## Exaggerating the removal (to make it visible)</span></span>
<span id="cb503-12"><a href="other-functionalities.html#cb503-12" aria-hidden="true"></a>tree_exaggerated &lt;-<span class="st"> </span><span class="kw">remove.zero.brlen</span>(tree, <span class="dt">slide =</span> <span class="dv">1</span>)</span>
<span id="cb503-13"><a href="other-functionalities.html#cb503-13" aria-hidden="true"></a></span>
<span id="cb503-14"><a href="other-functionalities.html#cb503-14" aria-hidden="true"></a><span class="co">## Check the differences</span></span>
<span id="cb503-15"><a href="other-functionalities.html#cb503-15" aria-hidden="true"></a><span class="kw">any</span>(tree<span class="op">$</span>edge.length <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb505-1"><a href="other-functionalities.html#cb505-1" aria-hidden="true"></a><span class="kw">any</span>(tree_no_zero<span class="op">$</span>edge.length <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb507"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb507-1"><a href="other-functionalities.html#cb507-1" aria-hidden="true"></a><span class="kw">any</span>(tree_exaggerated<span class="op">$</span>edge.length <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb509"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb509-1"><a href="other-functionalities.html#cb509-1" aria-hidden="true"></a><span class="co">## Display the results</span></span>
<span id="cb509-2"><a href="other-functionalities.html#cb509-2" aria-hidden="true"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">1</span>))</span>
<span id="cb509-3"><a href="other-functionalities.html#cb509-3" aria-hidden="true"></a><span class="kw">plot</span>(tree, <span class="dt">main =</span> <span class="st">&quot;with zero edges&quot;</span>)</span>
<span id="cb509-4"><a href="other-functionalities.html#cb509-4" aria-hidden="true"></a><span class="kw">plot</span>(tree_no_zero, <span class="dt">main =</span> <span class="st">&quot;without zero edges!&quot;</span>)</span>
<span id="cb509-5"><a href="other-functionalities.html#cb509-5" aria-hidden="true"></a><span class="kw">plot</span>(tree_exaggerated, <span class="dt">main =</span> <span class="st">&quot;with longer edges&quot;</span>)</span></code></pre></div>
<p><img src="dispRity_manual_files/figure-html/unnamed-chunk-179-1.png" width="672" /></p>
</div>
<div id="tree.age" class="section level2 hasAnchor" number="6.13">
<h2><span class="header-section-number">6.13</span> <code>tree.age</code><a href="other-functionalities.html#tree.age" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This function allows to quickly calculate the ages of each tips and nodes present in a tree.</p>
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb510-1"><a href="other-functionalities.html#cb510-1" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb510-2"><a href="other-functionalities.html#cb510-2" aria-hidden="true"></a>tree &lt;-<span class="st"> </span><span class="kw">rtree</span>(<span class="dv">10</span>)</span>
<span id="cb510-3"><a href="other-functionalities.html#cb510-3" aria-hidden="true"></a><span class="co">## The tree age from a 10 tip tree</span></span>
<span id="cb510-4"><a href="other-functionalities.html#cb510-4" aria-hidden="true"></a><span class="kw">tree.age</span>(tree)</span></code></pre></div>
<pre><code>##      ages elements
## 1  0.7068       t7
## 2  0.1417       t2
## 3  0.0000       t3
## 4  1.4675       t8
## 5  1.3656       t1
## 6  1.8949       t5
## 7  1.5360       t6
## 8  1.4558       t9
## 9  0.8147      t10
## 10 2.3426       t4
## 11 3.0111       11
## 12 2.6310       12
## 13 1.8536       13
## 14 0.9189       14
## 15 0.2672       15
## 16 2.6177       16
## 17 2.2353       17
## 18 2.1356       18
## 19 1.6420       19</code></pre>
<p>It also allows to set the age of the root of the tree:</p>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb512-1"><a href="other-functionalities.html#cb512-1" aria-hidden="true"></a><span class="co">## The ages starting from -100 units</span></span>
<span id="cb512-2"><a href="other-functionalities.html#cb512-2" aria-hidden="true"></a><span class="kw">tree.age</span>(tree, <span class="dt">age =</span> <span class="dv">100</span>)</span></code></pre></div>
<pre><code>##        ages elements
## 1   23.4717       t7
## 2    4.7048       t2
## 3    0.0000       t3
## 4   48.7362       t8
## 5   45.3517       t1
## 6   62.9315       t5
## 7   51.0119       t6
## 8   48.3486       t9
## 9   27.0554      t10
## 10  77.7998       t4
## 11 100.0000       11
## 12  87.3788       12
## 13  61.5593       13
## 14  30.5171       14
## 15   8.8746       15
## 16  86.9341       16
## 17  74.2347       17
## 18  70.9239       18
## 19  54.5330       19</code></pre>
<p>Usually tree age is calculated from the present to the past (e.g. in million years ago) but it is possible to reverse it using the <code>order = present</code> option:</p>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb514-1"><a href="other-functionalities.html#cb514-1" aria-hidden="true"></a><span class="co">## The ages in terms of tip/node height</span></span>
<span id="cb514-2"><a href="other-functionalities.html#cb514-2" aria-hidden="true"></a><span class="kw">tree.age</span>(tree, <span class="dt">order =</span> <span class="st">&quot;present&quot;</span>)</span></code></pre></div>
<pre><code>##      ages elements
## 1  2.3043       t7
## 2  2.8694       t2
## 3  3.0111       t3
## 4  1.5436       t8
## 5  1.6455       t1
## 6  1.1162       t5
## 7  1.4751       t6
## 8  1.5553       t9
## 9  2.1964      t10
## 10 0.6685       t4
## 11 0.0000       11
## 12 0.3800       12
## 13 1.1575       13
## 14 2.0922       14
## 15 2.7439       15
## 16 0.3934       16
## 17 0.7758       17
## 18 0.8755       18
## 19 1.3690       19</code></pre>
</div>
<div id="multi.ace" class="section level2 hasAnchor" number="6.14">
<h2><span class="header-section-number">6.14</span> <code>multi.ace</code><a href="other-functionalities.html#multi.ace" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This function allows to run ancestral characters estimations on multiple trees.
In it’s most basic structure (e.g. using all default arguments) this function is using a mix of <code>ape::ace</code> and <code>castor::asr_mk_model</code> depending on the data and the situation and is generally faster than both functions when applied to a list of trees.
However, this function provides also some more complex and modular functionalities, especially appropriate when using discrete morphological character data.</p>
<div id="using-different-character-tokens-in-different-situations" class="section level3 hasAnchor" number="6.14.1">
<h3><span class="header-section-number">6.14.1</span> Using different character tokens in different situations<a href="other-functionalities.html#using-different-character-tokens-in-different-situations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This data can be often coded in non-standard way with different character tokens having different meanings.
For example, in some datasets the token <code>-</code> can mean “the trait is inapplicable” but this can be also coded by the more conventional <code>NA</code> or can mean “this trait is missing” (often coded <code>?</code>).
This makes the meaning of specific tokens idiosyncratic to different matrices.
For example we can have the following discrete morphological matrix with all the data encoded:</p>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb516-1"><a href="other-functionalities.html#cb516-1" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb516-2"><a href="other-functionalities.html#cb516-2" aria-hidden="true"></a><span class="co">## A random tree with 10 tips</span></span>
<span id="cb516-3"><a href="other-functionalities.html#cb516-3" aria-hidden="true"></a>tree &lt;-<span class="st"> </span><span class="kw">rcoal</span>(<span class="dv">10</span>)</span>
<span id="cb516-4"><a href="other-functionalities.html#cb516-4" aria-hidden="true"></a><span class="co">## Setting up the parameters</span></span>
<span id="cb516-5"><a href="other-functionalities.html#cb516-5" aria-hidden="true"></a>my_rates =<span class="st"> </span><span class="kw">c</span>(rgamma, <span class="dt">rate =</span> <span class="dv">10</span>, <span class="dt">shape =</span> <span class="dv">5</span>)</span>
<span id="cb516-6"><a href="other-functionalities.html#cb516-6" aria-hidden="true"></a></span>
<span id="cb516-7"><a href="other-functionalities.html#cb516-7" aria-hidden="true"></a><span class="co">## Generating a bunch of trees</span></span>
<span id="cb516-8"><a href="other-functionalities.html#cb516-8" aria-hidden="true"></a>multiple_trees &lt;-<span class="st"> </span><span class="kw">rmtree</span>(<span class="dv">5</span>, <span class="dv">10</span>)</span>
<span id="cb516-9"><a href="other-functionalities.html#cb516-9" aria-hidden="true"></a></span>
<span id="cb516-10"><a href="other-functionalities.html#cb516-10" aria-hidden="true"></a><span class="co">## A random Mk matrix (10*50)</span></span>
<span id="cb516-11"><a href="other-functionalities.html#cb516-11" aria-hidden="true"></a>matrix_simple &lt;-<span class="st"> </span><span class="kw">sim.morpho</span>(tree, <span class="dt">characters =</span> <span class="dv">50</span>, <span class="dt">model =</span> <span class="st">&quot;ER&quot;</span>, <span class="dt">rates =</span> my_rates,</span>
<span id="cb516-12"><a href="other-functionalities.html#cb516-12" aria-hidden="true"></a>                            <span class="dt">invariant =</span> <span class="ot">FALSE</span>)</span>
<span id="cb516-13"><a href="other-functionalities.html#cb516-13" aria-hidden="true"></a>matrix_simple[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre><code>##     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
## t8  &quot;1&quot;  &quot;1&quot;  &quot;1&quot;  &quot;1&quot;  &quot;0&quot;  &quot;0&quot;  &quot;0&quot;  &quot;0&quot;  &quot;0&quot;  &quot;1&quot;  
## t3  &quot;1&quot;  &quot;1&quot;  &quot;1&quot;  &quot;1&quot;  &quot;0&quot;  &quot;0&quot;  &quot;0&quot;  &quot;0&quot;  &quot;0&quot;  &quot;1&quot;  
## t2  &quot;1&quot;  &quot;1&quot;  &quot;1&quot;  &quot;1&quot;  &quot;0&quot;  &quot;1&quot;  &quot;1&quot;  &quot;1&quot;  &quot;0&quot;  &quot;1&quot;  
## t1  &quot;1&quot;  &quot;1&quot;  &quot;1&quot;  &quot;1&quot;  &quot;0&quot;  &quot;0&quot;  &quot;1&quot;  &quot;1&quot;  &quot;0&quot;  &quot;1&quot;  
## t10 &quot;1&quot;  &quot;1&quot;  &quot;1&quot;  &quot;1&quot;  &quot;0&quot;  &quot;0&quot;  &quot;1&quot;  &quot;0&quot;  &quot;1&quot;  &quot;1&quot;  
## t9  &quot;1&quot;  &quot;1&quot;  &quot;1&quot;  &quot;1&quot;  &quot;0&quot;  &quot;0&quot;  &quot;1&quot;  &quot;0&quot;  &quot;0&quot;  &quot;1&quot;  
## t5  &quot;0&quot;  &quot;0&quot;  &quot;0&quot;  &quot;0&quot;  &quot;1&quot;  &quot;1&quot;  &quot;1&quot;  &quot;0&quot;  &quot;0&quot;  &quot;0&quot;  
## t6  &quot;0&quot;  &quot;0&quot;  &quot;0&quot;  &quot;0&quot;  &quot;1&quot;  &quot;1&quot;  &quot;1&quot;  &quot;0&quot;  &quot;0&quot;  &quot;0&quot;  
## t4  &quot;0&quot;  &quot;0&quot;  &quot;0&quot;  &quot;0&quot;  &quot;1&quot;  &quot;0&quot;  &quot;0&quot;  &quot;0&quot;  &quot;1&quot;  &quot;0&quot;  
## t7  &quot;0&quot;  &quot;0&quot;  &quot;0&quot;  &quot;0&quot;  &quot;1&quot;  &quot;0&quot;  &quot;0&quot;  &quot;0&quot;  &quot;1&quot;  &quot;0&quot;</code></pre>
<p>But of course, as mentioned above, in practice, such matrices have more nuance and can including missing characters, ambiguous characters, multi-state characters, inapplicable characters, etc…
All these coded and defined by different authors using different tokens (or symbols).
Let’s give it a go and transform this simple data to something more messy:</p>
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb518-1"><a href="other-functionalities.html#cb518-1" aria-hidden="true"></a><span class="co">## Modify the matrix to contain missing and special data</span></span>
<span id="cb518-2"><a href="other-functionalities.html#cb518-2" aria-hidden="true"></a>matrix_complex &lt;-<span class="st"> </span>matrix_simple</span>
<span id="cb518-3"><a href="other-functionalities.html#cb518-3" aria-hidden="true"></a><span class="co">## Adding 50 random &quot;-&quot; tokens</span></span>
<span id="cb518-4"><a href="other-functionalities.html#cb518-4" aria-hidden="true"></a>matrix_complex[<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(matrix_complex), <span class="dv">50</span>)] &lt;-<span class="st"> &quot;-&quot;</span></span>
<span id="cb518-5"><a href="other-functionalities.html#cb518-5" aria-hidden="true"></a><span class="co">## Adding 50 random &quot;?&quot; tokens</span></span>
<span id="cb518-6"><a href="other-functionalities.html#cb518-6" aria-hidden="true"></a>matrix_complex[<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(matrix_complex), <span class="dv">50</span>)] &lt;-<span class="st"> &quot;?&quot;</span></span>
<span id="cb518-7"><a href="other-functionalities.html#cb518-7" aria-hidden="true"></a><span class="co">## Adding 50 random &quot;0%2&quot; tokens</span></span>
<span id="cb518-8"><a href="other-functionalities.html#cb518-8" aria-hidden="true"></a>matrix_complex[<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(matrix_complex), <span class="dv">50</span>)] &lt;-<span class="st"> &quot;0%2&quot;</span></span>
<span id="cb518-9"><a href="other-functionalities.html#cb518-9" aria-hidden="true"></a>matrix_complex[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre><code>##     [,1] [,2]  [,3] [,4]  [,5]  [,6]  [,7]  [,8]  [,9] [,10]
## t8  &quot;1&quot;  &quot;1&quot;   &quot;1&quot;  &quot;1&quot;   &quot;?&quot;   &quot;0&quot;   &quot;0&quot;   &quot;0&quot;   &quot;0&quot;  &quot;0%2&quot;
## t3  &quot;1&quot;  &quot;-&quot;   &quot;1&quot;  &quot;1&quot;   &quot;?&quot;   &quot;0&quot;   &quot;0&quot;   &quot;0&quot;   &quot;0&quot;  &quot;1&quot;  
## t2  &quot;1&quot;  &quot;1&quot;   &quot;1&quot;  &quot;0%2&quot; &quot;0&quot;   &quot;0%2&quot; &quot;1&quot;   &quot;1&quot;   &quot;0&quot;  &quot;1&quot;  
## t1  &quot;1&quot;  &quot;1&quot;   &quot;1&quot;  &quot;1&quot;   &quot;0&quot;   &quot;0&quot;   &quot;1&quot;   &quot;?&quot;   &quot;0&quot;  &quot;1&quot;  
## t10 &quot;1&quot;  &quot;0%2&quot; &quot;1&quot;  &quot;1&quot;   &quot;-&quot;   &quot;?&quot;   &quot;0%2&quot; &quot;0%2&quot; &quot;1&quot;  &quot;1&quot;  
## t9  &quot;1&quot;  &quot;1&quot;   &quot;?&quot;  &quot;1&quot;   &quot;0%2&quot; &quot;0&quot;   &quot;1&quot;   &quot;0&quot;   &quot;0&quot;  &quot;1&quot;  
## t5  &quot;0&quot;  &quot;-&quot;   &quot;?&quot;  &quot;0&quot;   &quot;1&quot;   &quot;1&quot;   &quot;1&quot;   &quot;0&quot;   &quot;0&quot;  &quot;-&quot;  
## t6  &quot;0&quot;  &quot;-&quot;   &quot;0&quot;  &quot;0&quot;   &quot;1&quot;   &quot;1&quot;   &quot;-&quot;   &quot;-&quot;   &quot;?&quot;  &quot;0&quot;  
## t4  &quot;?&quot;  &quot;0&quot;   &quot;0&quot;  &quot;0&quot;   &quot;1&quot;   &quot;0&quot;   &quot;0&quot;   &quot;0&quot;   &quot;1&quot;  &quot;0&quot;  
## t7  &quot;0&quot;  &quot;0&quot;   &quot;0&quot;  &quot;0%2&quot; &quot;1&quot;   &quot;0&quot;   &quot;0&quot;   &quot;-&quot;   &quot;1&quot;  &quot;-&quot;</code></pre>
<p>In <code>multi.ace</code> you can specify what all these tokens actually mean and how the code should interpret them.
For example, <code>-</code> often means inapplicable data (i.e. the specimen does not have the coded feature, for example, the colour of the tail of a tailless bird); or <code>?</code> that often means missing data (i.e. it is unknown if the specimen has a tail or not since only the head was available).
And more than the differences in meaning between these characters, different people treat these characters differently even if they have the same meaning for the token.
For example, one might want to treat <code>-</code> as meaning “we don’t know” (which will be treated by the algorithm as “any possible trait value”) or “we know, and it’s no possible” (which will be treated by the algorithm as <code>NA</code>).
Because of this situation, <code>multi.ace</code> allows combining any special case marked with a special token to a special behaviour.
For example we might want to create a special case called <code>"missing"</code> (i.e. the data is missing) that we want to denote using the token <code>"?"</code> and we can specify the algorithm to treat this <code>"missing"</code> cases (<code>"?"</code>) as treating the character token value as “any possible values”.
This behaviour can be hard coded by providing a function with the name of the behaviour.
For example:</p>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb520-1"><a href="other-functionalities.html#cb520-1" aria-hidden="true"></a><span class="co">## The specific token for the missing cases (note the &quot;\\&quot; for protecting the value)</span></span>
<span id="cb520-2"><a href="other-functionalities.html#cb520-2" aria-hidden="true"></a>special.tokens &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;missing&quot;</span> =<span class="st"> &quot;</span><span class="ch">\\</span><span class="st">?&quot;</span>)</span>
<span id="cb520-3"><a href="other-functionalities.html#cb520-3" aria-hidden="true"></a></span>
<span id="cb520-4"><a href="other-functionalities.html#cb520-4" aria-hidden="true"></a><span class="co">## The behaviour for the missing cases (?)</span></span>
<span id="cb520-5"><a href="other-functionalities.html#cb520-5" aria-hidden="true"></a>special.behaviour &lt;-<span class="st"> </span><span class="kw">list</span>(missing &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) <span class="kw">return</span>(y))</span>
<span id="cb520-6"><a href="other-functionalities.html#cb520-6" aria-hidden="true"></a><span class="co">## Where x is the input value (here &quot;?&quot;) and y is all the possible normal values for the character</span></span></code></pre></div>
<p>This example shows a very common case (and is actually used by default, more on that below) but this architecture allows for very modular combination of tokens and behaviours.
For example, in our code above we introduced the token <code>"%"</code> which is very odd (to my knowledge) and might mean something very specific in our case.
Say we want to call this case <code>"weirdtoken"</code> and mean that whenever this token is encountered in a character, it should be interpreted by the algorithm as the values 1 and 2, no matter what:</p>
<div class="sourceCode" id="cb521"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb521-1"><a href="other-functionalities.html#cb521-1" aria-hidden="true"></a><span class="co">## Set a list of extra special tokens</span></span>
<span id="cb521-2"><a href="other-functionalities.html#cb521-2" aria-hidden="true"></a>my_spec_tokens &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;weirdtoken&quot;</span> =<span class="st"> &quot;</span><span class="ch">\\</span><span class="st">%&quot;</span>)</span>
<span id="cb521-3"><a href="other-functionalities.html#cb521-3" aria-hidden="true"></a></span>
<span id="cb521-4"><a href="other-functionalities.html#cb521-4" aria-hidden="true"></a><span class="co">## Weird tokens are considered as state 0 and 3</span></span>
<span id="cb521-5"><a href="other-functionalities.html#cb521-5" aria-hidden="true"></a>my_spec_behaviours &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb521-6"><a href="other-functionalities.html#cb521-6" aria-hidden="true"></a>my_spec_behaviours<span class="op">$</span>weirdtoken &lt;-<span class="st"> </span><span class="cf">function</span>(x,y) <span class="kw">return</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span></code></pre></div>
<p>If you don’t need/don’t have any of this specific tokens, don’t worry, most special but common tokens are handled by default as such:</p>
<div class="sourceCode" id="cb522"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb522-1"><a href="other-functionalities.html#cb522-1" aria-hidden="true"></a><span class="co">## The token for missing values:</span></span>
<span id="cb522-2"><a href="other-functionalities.html#cb522-2" aria-hidden="true"></a>default_tokens &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;missing&quot;</span>      =<span class="st"> &quot;</span><span class="ch">\\</span><span class="st">?&quot;</span>,</span>
<span id="cb522-3"><a href="other-functionalities.html#cb522-3" aria-hidden="true"></a><span class="co">## The token for inapplicable values:                    </span></span>
<span id="cb522-4"><a href="other-functionalities.html#cb522-4" aria-hidden="true"></a>                    <span class="st">&quot;inapplicable&quot;</span> =<span class="st"> &quot;</span><span class="ch">\\</span><span class="st">-&quot;</span>,</span>
<span id="cb522-5"><a href="other-functionalities.html#cb522-5" aria-hidden="true"></a><span class="co">## The token for polymorphisms:</span></span>
<span id="cb522-6"><a href="other-functionalities.html#cb522-6" aria-hidden="true"></a>                    <span class="st">&quot;polymorphism&quot;</span> =<span class="st"> &quot;</span><span class="ch">\\</span><span class="st">&amp;&quot;</span>,</span>
<span id="cb522-7"><a href="other-functionalities.html#cb522-7" aria-hidden="true"></a><span class="co">## The token for uncertainties:</span></span>
<span id="cb522-8"><a href="other-functionalities.html#cb522-8" aria-hidden="true"></a>                    <span class="st">&quot;uncertanity&quot;</span>  =<span class="st"> &quot;</span><span class="ch">\\</span><span class="st">/&quot;</span>)</span></code></pre></div>
<p>With the following associated default behaviours</p>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb523-1"><a href="other-functionalities.html#cb523-1" aria-hidden="true"></a><span class="co">## Treating missing data as all data values</span></span>
<span id="cb523-2"><a href="other-functionalities.html#cb523-2" aria-hidden="true"></a>default_behaviour &lt;-<span class="st"> </span><span class="kw">list</span>(missing      &lt;-<span class="st"> </span><span class="cf">function</span>(x,y) y,</span>
<span id="cb523-3"><a href="other-functionalities.html#cb523-3" aria-hidden="true"></a><span class="co">## Treating inapplicable data as all data values (like missing)    </span></span>
<span id="cb523-4"><a href="other-functionalities.html#cb523-4" aria-hidden="true"></a>                          inapplicable &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) y,</span>
<span id="cb523-5"><a href="other-functionalities.html#cb523-5" aria-hidden="true"></a><span class="co">## Treating polymorphisms as all values present:</span></span>
<span id="cb523-6"><a href="other-functionalities.html#cb523-6" aria-hidden="true"></a>                          polymorphism &lt;-<span class="st"> </span><span class="cf">function</span>(x,y) <span class="kw">strsplit</span>(x, <span class="dt">split =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">&amp;&quot;</span>)[[<span class="dv">1</span>]],</span>
<span id="cb523-7"><a href="other-functionalities.html#cb523-7" aria-hidden="true"></a><span class="co">## Treating uncertainties as all values present (like polymorphisms):</span></span>
<span id="cb523-8"><a href="other-functionalities.html#cb523-8" aria-hidden="true"></a>                          uncertanity  &lt;-<span class="st"> </span><span class="cf">function</span>(x,y) <span class="kw">strsplit</span>(x, <span class="dt">split =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">&amp;&quot;</span>)[[<span class="dv">1</span>]])</span></code></pre></div>
<p>We can then use these token description along with our complex matrix and our list of trees to run the ancestral states estimations as follows:</p>
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb524-1"><a href="other-functionalities.html#cb524-1" aria-hidden="true"></a><span class="co">## Running ancestral states</span></span>
<span id="cb524-2"><a href="other-functionalities.html#cb524-2" aria-hidden="true"></a>ancestral_states &lt;-<span class="st"> </span><span class="kw">multi.ace</span>(matrix_complex, multiple_trees,</span>
<span id="cb524-3"><a href="other-functionalities.html#cb524-3" aria-hidden="true"></a>                              <span class="dt">special.tokens =</span> my_spec_tokens,</span>
<span id="cb524-4"><a href="other-functionalities.html#cb524-4" aria-hidden="true"></a>                              <span class="dt">special.behaviours =</span> my_spec_behaviours,</span>
<span id="cb524-5"><a href="other-functionalities.html#cb524-5" aria-hidden="true"></a>                              <span class="dt">verbose =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## Preparing the data:...</code></pre>
<pre><code>## Warning: The character 39 is invariant (using the current special behaviours
## for special characters) and is simply duplicated for each node.</code></pre>
<pre><code>## ..Done.
## Running ancestral states estimations:.....................................................................................................................................................................................................................................................Done.</code></pre>
<div class="sourceCode" id="cb528"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb528-1"><a href="other-functionalities.html#cb528-1" aria-hidden="true"></a><span class="co">## This outputs a list of ancestral parts of the matrices for each tree</span></span>
<span id="cb528-2"><a href="other-functionalities.html#cb528-2" aria-hidden="true"></a><span class="co">## For example, here&#39;s the first one:</span></span>
<span id="cb528-3"><a href="other-functionalities.html#cb528-3" aria-hidden="true"></a>ancestral_states[[<span class="dv">1</span>]][<span class="dv">1</span><span class="op">:</span><span class="dv">9</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre><code>##    [,1] [,2]  [,3]  [,4] [,5]  [,6]    [,7]  [,8] [,9] [,10]
## n1 &quot;1&quot;  &quot;1&quot;   &quot;1&quot;   &quot;1&quot;  &quot;1&quot;   &quot;0/1/2&quot; &quot;1&quot;   &quot;0&quot;  &quot;0&quot;  &quot;1&quot;  
## n2 &quot;1&quot;  &quot;1&quot;   &quot;1&quot;   &quot;1&quot;  &quot;0/1&quot; &quot;0/1/2&quot; &quot;0/1&quot; &quot;0&quot;  &quot;0&quot;  &quot;1&quot;  
## n3 &quot;1&quot;  &quot;1&quot;   &quot;1&quot;   &quot;1&quot;  &quot;0/1&quot; &quot;0/1/2&quot; &quot;0&quot;   &quot;0&quot;  &quot;0&quot;  &quot;1&quot;  
## n4 &quot;1&quot;  &quot;1&quot;   &quot;1&quot;   &quot;1&quot;  &quot;0&quot;   &quot;0/1/2&quot; &quot;1&quot;   &quot;1&quot;  &quot;0&quot;  &quot;1&quot;  
## n5 &quot;1&quot;  &quot;1&quot;   &quot;1&quot;   &quot;1&quot;  &quot;1&quot;   &quot;0/1/2&quot; &quot;1&quot;   &quot;0&quot;  &quot;0&quot;  &quot;1&quot;  
## n6 &quot;1&quot;  &quot;1&quot;   &quot;1&quot;   &quot;1&quot;  &quot;1&quot;   &quot;0/1/2&quot; &quot;1&quot;   &quot;0&quot;  &quot;0&quot;  &quot;1&quot;  
## n7 &quot;0&quot;  &quot;0/1&quot; &quot;0/1&quot; &quot;0&quot;  &quot;1&quot;   &quot;1&quot;     &quot;1&quot;   &quot;0&quot;  &quot;0&quot;  &quot;0/1&quot;
## n8 &quot;0&quot;  &quot;0&quot;   &quot;0&quot;   &quot;0&quot;  &quot;1&quot;   &quot;0/1/2&quot; &quot;0&quot;   &quot;0&quot;  &quot;1&quot;  &quot;0&quot;  
## n9 &quot;0&quot;  &quot;0&quot;   &quot;0&quot;   &quot;0&quot;  &quot;1&quot;   &quot;1&quot;     &quot;0&quot;   &quot;0&quot;  &quot;1&quot;  &quot;0&quot;</code></pre>
<p>Note that there are many different options that are not covered here.
For example, you can use different models for each character via the <code>models</code> argument, you can specify how to handle uncertainties via the <code>threshold</code> argument, use a branch length modifier (<code>brlen.multiplier</code>), specify the type of output, etc…</p>
</div>
<div id="feeding-the-results-to-char.diff-to-get-distance-matrices" class="section level3 hasAnchor" number="6.14.2">
<h3><span class="header-section-number">6.14.2</span> Feeding the results to <code>char.diff</code> to get distance matrices<a href="other-functionalities.html#feeding-the-results-to-char.diff-to-get-distance-matrices" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>After running your ancestral states estimations, it is not uncommon to then use these resulting data to calculate the distances between taxa and then ordinate the results to measure disparity.
You can do that using the <code>char.diff</code> function <a href="other-functionalities.html#char.diff">described above</a> but instead of measuring the distances between characters (columns) you can measure the distances between species (rows).
You might notice that this function uses the same modular token and behaviour descriptions.
That makes sense because they’re using the same core C functions implemented in dispRity that greatly speed up distance calculations.</p>
<div class="sourceCode" id="cb530"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb530-1"><a href="other-functionalities.html#cb530-1" aria-hidden="true"></a><span class="co">## Running ancestral states</span></span>
<span id="cb530-2"><a href="other-functionalities.html#cb530-2" aria-hidden="true"></a><span class="co">## and outputing a list of combined matrices (tips and nodes)</span></span>
<span id="cb530-3"><a href="other-functionalities.html#cb530-3" aria-hidden="true"></a>ancestral_states &lt;-<span class="st"> </span><span class="kw">multi.ace</span>(matrix_complex, multiple_trees,</span>
<span id="cb530-4"><a href="other-functionalities.html#cb530-4" aria-hidden="true"></a>                              <span class="dt">special.tokens =</span> my_spec_tokens,</span>
<span id="cb530-5"><a href="other-functionalities.html#cb530-5" aria-hidden="true"></a>                              <span class="dt">special.behaviours =</span> my_spec_behaviours,</span>
<span id="cb530-6"><a href="other-functionalities.html#cb530-6" aria-hidden="true"></a>                              <span class="dt">output =</span> <span class="st">&quot;combined.matrix&quot;</span>,</span>
<span id="cb530-7"><a href="other-functionalities.html#cb530-7" aria-hidden="true"></a>                              <span class="dt">verbose =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## Preparing the data:...</code></pre>
<pre><code>## Warning: The character 39 is invariant (using the current special behaviours
## for special characters) and is simply duplicated for each node.</code></pre>
<pre><code>## ..Done.
## Running ancestral states estimations:.....................................................................................................................................................................................................................................................Done.</code></pre>
<p>We can then feed these matrices directly to <code>char.diff</code>, say for calculating the “MORD” distance:</p>
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb534-1"><a href="other-functionalities.html#cb534-1" aria-hidden="true"></a><span class="co">## Measuring the distances between rows using the MORD distance</span></span>
<span id="cb534-2"><a href="other-functionalities.html#cb534-2" aria-hidden="true"></a>distances &lt;-<span class="st"> </span><span class="kw">lapply</span>(ancestral_states, char.diff, <span class="dt">method =</span> <span class="st">&quot;mord&quot;</span>, <span class="dt">by.col =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p>And we now have a list of distances matrices with ancestral states estimated!</p>
</div>
<div id="running-ancestral-states-estimations-for-continuous-characters" class="section level3 hasAnchor" number="6.14.3">
<h3><span class="header-section-number">6.14.3</span> Running ancestral states estimations for continuous characters<a href="other-functionalities.html#running-ancestral-states-estimations-for-continuous-characters" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You can also run <code>multi.ace</code> on continuous characters.
The function detects any continuous characters as being of class <code>"numeric"</code> and runs them using the <code>ape::ace</code> function.</p>
<div class="sourceCode" id="cb535"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb535-1"><a href="other-functionalities.html#cb535-1" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb535-2"><a href="other-functionalities.html#cb535-2" aria-hidden="true"></a><span class="co">## Creating three coalescent trees</span></span>
<span id="cb535-3"><a href="other-functionalities.html#cb535-3" aria-hidden="true"></a>my_trees &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">3</span>, <span class="kw">rcoal</span>(<span class="dv">15</span>), <span class="dt">simplify =</span> <span class="ot">FALSE</span>)</span>
<span id="cb535-4"><a href="other-functionalities.html#cb535-4" aria-hidden="true"></a><span class="co">## Adding node labels</span></span>
<span id="cb535-5"><a href="other-functionalities.html#cb535-5" aria-hidden="true"></a>my_trees &lt;-<span class="st"> </span><span class="kw">lapply</span>(my_trees, makeNodeLabel)</span>
<span id="cb535-6"><a href="other-functionalities.html#cb535-6" aria-hidden="true"></a><span class="co">## Making into a multiPhylo object</span></span>
<span id="cb535-7"><a href="other-functionalities.html#cb535-7" aria-hidden="true"></a><span class="kw">class</span>(my_trees) &lt;-<span class="st"> &quot;multiPhylo&quot;</span></span>
<span id="cb535-8"><a href="other-functionalities.html#cb535-8" aria-hidden="true"></a></span>
<span id="cb535-9"><a href="other-functionalities.html#cb535-9" aria-hidden="true"></a><span class="co">## Creating a matrix of continuous characters</span></span>
<span id="cb535-10"><a href="other-functionalities.html#cb535-10" aria-hidden="true"></a>data &lt;-<span class="st"> </span><span class="kw">space.maker</span>(<span class="dt">elements =</span> <span class="dv">15</span>, <span class="dt">dimensions =</span> <span class="dv">5</span>, <span class="dt">distribution =</span> rnorm,</span>
<span id="cb535-11"><a href="other-functionalities.html#cb535-11" aria-hidden="true"></a>                    <span class="dt">elements.name =</span> my_trees[[<span class="dv">1</span>]]<span class="op">$</span>tip.label)</span></code></pre></div>
<p>With such data and trees you can easily run the <code>multi.ace</code> estimations.
By default, the estimations use the default arguments from <code>ape::ace</code>, knowingly a Brownian Motion (<code>model = "BM"</code>) with the REML method (<code>method = "REML"</code>; this method “first estimates the ancestral value at the root (aka, the phylogenetic mean), then the variance of the Brownian motion process is estimated by optimizing the residual log-likelihood” - from <code>?ape::ace</code>).</p>
<div class="sourceCode" id="cb536"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb536-1"><a href="other-functionalities.html#cb536-1" aria-hidden="true"></a><span class="co">## Running multi.ace on continuous data</span></span>
<span id="cb536-2"><a href="other-functionalities.html#cb536-2" aria-hidden="true"></a>my_ancestral_states &lt;-<span class="st"> </span><span class="kw">multi.ace</span>(data, my_trees)</span></code></pre></div>
<pre><code>## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced</code></pre>
<div class="sourceCode" id="cb538"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb538-1"><a href="other-functionalities.html#cb538-1" aria-hidden="true"></a><span class="co">## We end up with three matrices of node states estimates</span></span>
<span id="cb538-2"><a href="other-functionalities.html#cb538-2" aria-hidden="true"></a><span class="kw">str</span>(my_ancestral_states)</span></code></pre></div>
<pre><code>## List of 3
##  $ : num [1:14, 1:5] -0.191 -0.155 -0.227 -0.17 0.138 ...
##   ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. ..$ : chr [1:14] &quot;Node1&quot; &quot;Node2&quot; &quot;Node3&quot; &quot;Node4&quot; ...
##   .. ..$ : NULL
##  $ : num [1:14, 1:5] -0.385 -0.552 -0.445 -0.435 -0.478 ...
##   ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. ..$ : chr [1:14] &quot;Node1&quot; &quot;Node2&quot; &quot;Node3&quot; &quot;Node4&quot; ...
##   .. ..$ : NULL
##  $ : num [1:14, 1:5] -0.3866 -0.2232 -0.0592 -0.7246 -0.2253 ...
##   ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. ..$ : chr [1:14] &quot;Node1&quot; &quot;Node2&quot; &quot;Node3&quot; &quot;Node4&quot; ...
##   .. ..$ : NULL</code></pre>
<p>This results in three matrices with ancestral states for the nodes.
When using continuous characters, however, you can output the results directly as a <code>dispRity</code> object that allows visualisation and other normal dispRity pipeline:</p>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb540-1"><a href="other-functionalities.html#cb540-1" aria-hidden="true"></a><span class="co">## Running multi.ace on continuous data</span></span>
<span id="cb540-2"><a href="other-functionalities.html#cb540-2" aria-hidden="true"></a>my_ancestral_states &lt;-<span class="st"> </span><span class="kw">multi.ace</span>(data, my_trees, <span class="dt">output =</span> <span class="st">&quot;dispRity&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced</code></pre>
<div class="sourceCode" id="cb542"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb542-1"><a href="other-functionalities.html#cb542-1" aria-hidden="true"></a><span class="co">## We end up with three matrices of node states estimates</span></span>
<span id="cb542-2"><a href="other-functionalities.html#cb542-2" aria-hidden="true"></a><span class="kw">plot</span>(my_ancestral_states)</span></code></pre></div>
<p><img src="dispRity_manual_files/figure-html/unnamed-chunk-194-1.png" width="672" /></p>
<p>You can also mix continuous and discrete characters together.
By default the <code>multi.ace</code> detects which character is of which type and applies the correct estimations based on that.
However you can always specify models or other details character per characters.</p>
<div class="sourceCode" id="cb543"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb543-1"><a href="other-functionalities.html#cb543-1" aria-hidden="true"></a><span class="co">## Adding two discrete characters</span></span>
<span id="cb543-2"><a href="other-functionalities.html#cb543-2" aria-hidden="true"></a>data &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(data)</span>
<span id="cb543-3"><a href="other-functionalities.html#cb543-3" aria-hidden="true"></a>data &lt;-<span class="st"> </span><span class="kw">cbind</span>(data, <span class="st">&quot;new_char&quot;</span> =<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dv">15</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)))</span>
<span id="cb543-4"><a href="other-functionalities.html#cb543-4" aria-hidden="true"></a>data &lt;-<span class="st"> </span><span class="kw">cbind</span>(data, <span class="st">&quot;new_char2&quot;</span> =<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dv">15</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)))</span>
<span id="cb543-5"><a href="other-functionalities.html#cb543-5" aria-hidden="true"></a></span>
<span id="cb543-6"><a href="other-functionalities.html#cb543-6" aria-hidden="true"></a><span class="co">## Setting up different models for each characters</span></span>
<span id="cb543-7"><a href="other-functionalities.html#cb543-7" aria-hidden="true"></a><span class="co">## BM for all 5 continuous characters</span></span>
<span id="cb543-8"><a href="other-functionalities.html#cb543-8" aria-hidden="true"></a><span class="co">## and ER and ARD for the two discrete ones</span></span>
<span id="cb543-9"><a href="other-functionalities.html#cb543-9" aria-hidden="true"></a>my_models &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;BM&quot;</span>, <span class="dv">5</span>), <span class="st">&quot;ER&quot;</span>, <span class="st">&quot;ARD&quot;</span>)</span>
<span id="cb543-10"><a href="other-functionalities.html#cb543-10" aria-hidden="true"></a></span>
<span id="cb543-11"><a href="other-functionalities.html#cb543-11" aria-hidden="true"></a><span class="co">## Running the estimation with the specified models</span></span>
<span id="cb543-12"><a href="other-functionalities.html#cb543-12" aria-hidden="true"></a>my_ancestral_states &lt;-<span class="st"> </span><span class="kw">multi.ace</span>(data, my_trees, <span class="dt">models =</span> my_models)</span></code></pre></div>
<pre><code>## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced

## Warning in sqrt(1/out$hessian): NaNs produced</code></pre>
<p>Of course all the options discussed in the first part above also can apply here!</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="making-stuff-up.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="the-guts-of-the-disprity-package.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/TGuillerme/dispRity/inst/gitbook/edit/master/05_other-functionalities.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
